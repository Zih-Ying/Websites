<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Sec 5 Collaborative filtering | Recommender System</title>
  <meta name="description" content="Sec 5 Collaborative filtering | Recommender System" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Sec 5 Collaborative filtering | Recommender System" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Sec 5 Collaborative filtering | Recommender System" />
  
  
  

<meta name="author" content="ZIH-YING, LI" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="self-learning-1.html"/>
<link rel="next" href="self-learning-2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.30/datatables.js"></script>
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #2a211c;
    color: #bdae9d;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #bdae9d;  padding-left: 4px; }
div.sourceCode
  { color: #bdae9d; background-color: #2a211c; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffff00; } /* Alert */
code span.an { color: #0066ff; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #44aa43; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #43a8ed; font-weight: bold; } /* ControlFlow */
code span.ch { color: #049b0a; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #0066ff; font-weight: bold; font-style: italic; } /* Comment */
code span.do { color: #0066ff; font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.dv { color: #44aa43; } /* DecVal */
code span.er { color: #ffff00; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #44aa43; } /* Float */
code span.fu { color: #ff9358; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #0066ff; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #43a8ed; font-weight: bold; } /* Keyword */
code span.op { } /* Operator */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.sc { color: #049b0a; } /* SpecialChar */
code span.ss { color: #049b0a; } /* SpecialString */
code span.st { color: #049b0a; } /* String */
code span.va { } /* Variable */
code span.vs { color: #049b0a; } /* VerbatimString */
code span.wa { color: #ffff00; font-weight: bold; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Recommender System</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="note.html"><a href="note.html"><i class="fa fa-check"></i>Note</a></li>
<li class="chapter" data-level="" data-path="problem.html"><a href="problem.html"><i class="fa fa-check"></i>Problem</a></li>
<li class="part"><span><b>I Conjoint Analysis</b></span></li>
<li class="chapter" data-level="1" data-path="conjoint-analysis.html"><a href="conjoint-analysis.html"><i class="fa fa-check"></i><b>1</b> Conjoint Analysis</a>
<ul>
<li class="chapter" data-level="1.1" data-path="conjoint-analysis.html"><a href="conjoint-analysis.html#example"><i class="fa fa-check"></i><b>1.1</b> Example</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="conjoint-analysis.html"><a href="conjoint-analysis.html#preprocess"><i class="fa fa-check"></i><b>1.1.1</b> Preprocess</a></li>
<li class="chapter" data-level="1.1.2" data-path="conjoint-analysis.html"><a href="conjoint-analysis.html#compute-part-worth"><i class="fa fa-check"></i><b>1.1.2</b> Compute part-worth</a></li>
<li class="chapter" data-level="1.1.3" data-path="conjoint-analysis.html"><a href="conjoint-analysis.html#compute-relative-importance"><i class="fa fa-check"></i><b>1.1.3</b> Compute relative importance</a></li>
<li class="chapter" data-level="1.1.4" data-path="conjoint-analysis.html"><a href="conjoint-analysis.html#output"><i class="fa fa-check"></i><b>1.1.4</b> Output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="self-learning.html"><a href="self-learning.html"><i class="fa fa-check"></i><b>2</b> Self-learning</a>
<ul>
<li class="chapter" data-level="2.1" data-path="self-learning.html"><a href="self-learning.html#enter-new-ranking"><i class="fa fa-check"></i><b>2.1</b> Enter new ranking</a></li>
<li class="chapter" data-level="2.2" data-path="self-learning.html"><a href="self-learning.html#add-interaction"><i class="fa fa-check"></i><b>2.2</b> Add interaction</a></li>
<li class="chapter" data-level="2.3" data-path="self-learning.html"><a href="self-learning.html#rewrite-spine_chart.r"><i class="fa fa-check"></i><b>2.3</b> Rewrite spine_chart.R</a></li>
</ul></li>
<li class="part"><span><b>II Association Rule</b></span></li>
<li class="chapter" data-level="3" data-path="association-rule.html"><a href="association-rule.html"><i class="fa fa-check"></i><b>3</b> Association Rule</a>
<ul>
<li class="chapter" data-level="3.1" data-path="association-rule.html"><a href="association-rule.html#evaluation-metrics"><i class="fa fa-check"></i><b>3.1</b> Evaluation Metrics</a></li>
<li class="chapter" data-level="3.2" data-path="association-rule.html"><a href="association-rule.html#example-dvd"><i class="fa fa-check"></i><b>3.2</b> Example: DVD</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="association-rule.html"><a href="association-rule.html#prepare-data"><i class="fa fa-check"></i><b>3.2.1</b> Prepare data</a></li>
<li class="chapter" data-level="3.2.2" data-path="association-rule.html"><a href="association-rule.html#mining-rules"><i class="fa fa-check"></i><b>3.2.2</b> Mining rules</a></li>
<li class="chapter" data-level="3.2.3" data-path="association-rule.html"><a href="association-rule.html#by-apriori-get-rules"><i class="fa fa-check"></i><b>3.2.3</b> By Apriori get rules</a></li>
<li class="chapter" data-level="3.2.4" data-path="association-rule.html"><a href="association-rule.html#by-eclat-equivalence-class-clustering-and-bottom-up-lattice-traversal."><i class="fa fa-check"></i><b>3.2.4</b> By Eclat: Equivalence Class Clustering and bottom-up Lattice Traversal.</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="association-rule.html"><a href="association-rule.html#example-income"><i class="fa fa-check"></i><b>3.3</b> Example: Income</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="association-rule.html"><a href="association-rule.html#IFP-ex"><i class="fa fa-check"></i><b>3.3.1</b> explore data</a></li>
<li class="chapter" data-level="3.3.2" data-path="association-rule.html"><a href="association-rule.html#get-rules-with-apriori"><i class="fa fa-check"></i><b>3.3.2</b> get rules with apriori</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="association-rule.html"><a href="association-rule.html#處理多餘規則-example-groceries"><i class="fa fa-check"></i><b>3.4</b> [處理多餘規則] Example: Groceries</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="association-rule.html"><a href="association-rule.html#基本處理"><i class="fa fa-check"></i><b>3.4.1</b> 基本處理</a></li>
<li class="chapter" data-level="3.4.2" data-path="association-rule.html"><a href="association-rule.html#處理冗贅的規則"><i class="fa fa-check"></i><b>3.4.2</b> 處理冗贅的規則</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="self-learning-1.html"><a href="self-learning-1.html"><i class="fa fa-check"></i><b>4</b> Self-learning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="self-learning-1.html"><a href="self-learning-1.html#check-details-of-income-data-set"><i class="fa fa-check"></i><b>4.1</b> check details of <code>Income</code> data set</a></li>
<li class="chapter" data-level="4.2" data-path="self-learning-1.html"><a href="self-learning-1.html#compare-different-grouping-regroup-income-into-2-levels"><i class="fa fa-check"></i><b>4.2</b> [compare different grouping] regroup income into 2 levels</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="self-learning-1.html"><a href="self-learning-1.html#explore-data"><i class="fa fa-check"></i><b>4.2.1</b> explore data</a></li>
<li class="chapter" data-level="4.2.2" data-path="self-learning-1.html"><a href="self-learning-1.html#explore-rule"><i class="fa fa-check"></i><b>4.2.2</b> explore rule</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="self-learning-1.html"><a href="self-learning-1.html#compare-different-algorithm-mine-rule-of-adultuci-data-set"><i class="fa fa-check"></i><b>4.3</b> [compare different algorithm] mine rule of <code>AdultUCI</code> data set</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="self-learning-1.html"><a href="self-learning-1.html#details-of-data"><i class="fa fa-check"></i><b>4.3.1</b> details of data</a></li>
<li class="chapter" data-level="4.3.2" data-path="self-learning-1.html"><a href="self-learning-1.html#explore-data-1"><i class="fa fa-check"></i><b>4.3.2</b> explore data</a></li>
<li class="chapter" data-level="4.3.3" data-path="self-learning-1.html"><a href="self-learning-1.html#explore-rule-1"><i class="fa fa-check"></i><b>4.3.3</b> explore rule</a></li>
<li class="chapter" data-level="4.3.4" data-path="self-learning-1.html"><a href="self-learning-1.html#conclusion"><i class="fa fa-check"></i><b>4.3.4</b> conclusion</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="self-learning-1.html"><a href="self-learning-1.html#就診紀錄"><i class="fa fa-check"></i><b>4.4</b> 就診紀錄</a></li>
<li class="chapter" data-level="4.5" data-path="self-learning-1.html"><a href="self-learning-1.html#早餐店購買紀錄"><i class="fa fa-check"></i><b>4.5</b> 早餐店購買紀錄</a></li>
<li class="chapter" data-level="4.6" data-path="self-learning-1.html"><a href="self-learning-1.html#groceries-data"><i class="fa fa-check"></i><b>4.6</b> Groceries data</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="self-learning-1.html"><a href="self-learning-1.html#rightarrow-item"><i class="fa fa-check"></i><b>4.6.1</b> ??? <span class="math inline">\(\rightarrow\)</span> item</a></li>
<li class="chapter" data-level="4.6.2" data-path="self-learning-1.html"><a href="self-learning-1.html#item-rightarrow"><i class="fa fa-check"></i><b>4.6.2</b> item <span class="math inline">\(\rightarrow\)</span> ???</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Collaborative filtering</b></span></li>
<li class="chapter" data-level="5" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html"><i class="fa fa-check"></i><b>5</b> Collaborative filtering</a>
<ul>
<li class="chapter" data-level="5.1" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#methods-for-realratingmatrix-class"><i class="fa fa-check"></i><b>5.1</b> Methods for “realRatingMatrix” Class</a></li>
<li class="chapter" data-level="5.2" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#compare-the-storage-sizes"><i class="fa fa-check"></i><b>5.2</b> Compare the storage sizes</a></li>
<li class="chapter" data-level="5.3" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#computie-similarity-matrix"><i class="fa fa-check"></i><b>5.3</b> Computie Similarity Matrix</a></li>
<li class="chapter" data-level="5.4" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#recommender-model"><i class="fa fa-check"></i><b>5.4</b> Recommender Model</a></li>
<li class="chapter" data-level="5.5" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>5.5</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#rating"><i class="fa fa-check"></i><b>5.5.1</b> Rating</a></li>
<li class="chapter" data-level="5.5.2" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#movie-views"><i class="fa fa-check"></i><b>5.5.2</b> Movie views</a></li>
<li class="chapter" data-level="5.5.3" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#average-ratings"><i class="fa fa-check"></i><b>5.5.3</b> Average ratings</a></li>
<li class="chapter" data-level="5.5.4" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#rating-matrix"><i class="fa fa-check"></i><b>5.5.4</b> Rating Matrix</a></li>
<li class="chapter" data-level="5.5.5" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#normalize"><i class="fa fa-check"></i><b>5.5.5</b> Normalize</a></li>
<li class="chapter" data-level="5.5.6" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#binarization"><i class="fa fa-check"></i><b>5.5.6</b> Binarization</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#rating-example-movie"><i class="fa fa-check"></i><b>5.6</b> [Rating] Example: Movie</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#IBCF"><i class="fa fa-check"></i><b>5.6.1</b> [Rating] Item-based Collaborative Filtering</a></li>
<li class="chapter" data-level="5.6.2" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#UBCF"><i class="fa fa-check"></i><b>5.6.2</b> [Rating] User-based Collaborative Filtering</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#binary-example-movie"><i class="fa fa-check"></i><b>5.7</b> [Binary] Example: Movie</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#binary-item-based-collaborative-filtering"><i class="fa fa-check"></i><b>5.7.1</b> [Binary] Item-based Collaborative Filtering</a></li>
<li class="chapter" data-level="5.7.2" data-path="collaborative-filtering.html"><a href="collaborative-filtering.html#binary-user-based-collaborative-filtering"><i class="fa fa-check"></i><b>5.7.2</b> [Binary] User-based Collaborative Filtering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="self-learning-2.html"><a href="self-learning-2.html"><i class="fa fa-check"></i><b>6</b> Self-learning</a>
<ul>
<li class="chapter" data-level="6.1" data-path="self-learning-2.html"><a href="self-learning-2.html#eda-movielens"><i class="fa fa-check"></i><b>6.1</b> [EDA] MovieLens</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="self-learning-2.html"><a href="self-learning-2.html#get-data"><i class="fa fa-check"></i><b>6.1.1</b> Get data</a></li>
<li class="chapter" data-level="6.1.2" data-path="self-learning-2.html"><a href="self-learning-2.html#eda"><i class="fa fa-check"></i><b>6.1.2</b> EDA</a></li>
<li class="chapter" data-level="6.1.3" data-path="self-learning-2.html"><a href="self-learning-2.html#adjust-plot-output"><i class="fa fa-check"></i><b>6.1.3</b> Adjust plot output</a></li>
<li class="chapter" data-level="6.1.4" data-path="self-learning-2.html"><a href="self-learning-2.html#average-ratings-1"><i class="fa fa-check"></i><b>6.1.4</b> Average Ratings</a></li>
<li class="chapter" data-level="6.1.5" data-path="self-learning-2.html"><a href="self-learning-2.html#rating-matrix-1"><i class="fa fa-check"></i><b>6.1.5</b> Rating Matrix</a></li>
<li class="chapter" data-level="6.1.6" data-path="self-learning-2.html"><a href="self-learning-2.html#normalize-1"><i class="fa fa-check"></i><b>6.1.6</b> Normalize</a></li>
<li class="chapter" data-level="6.1.7" data-path="self-learning-2.html"><a href="self-learning-2.html#binarization-1"><i class="fa fa-check"></i><b>6.1.7</b> Binarization</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="self-learning-2.html"><a href="self-learning-2.html#cf-movielens"><i class="fa fa-check"></i><b>6.2</b> [CF] MovieLens</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="self-learning-2.html"><a href="self-learning-2.html#problem1"><i class="fa fa-check"></i><b>6.2.1</b> Use <code>similarity()</code> to recheck Hand-on problem 1</a></li>
<li class="chapter" data-level="6.2.2" data-path="self-learning-2.html"><a href="self-learning-2.html#similarity-try-using-robust-statistic"><i class="fa fa-check"></i><b>6.2.2</b> Similarity: try using robust statistic</a></li>
<li class="chapter" data-level="6.2.3" data-path="self-learning-2.html"><a href="self-learning-2.html#why-the-following-code-get-different-results-between-hand-on-problem-2"><i class="fa fa-check"></i><b>6.2.3</b> Why the following code get different results between Hand-on problem 2</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Final Project</b></span></li>
<li class="chapter" data-level="7" data-path="final-project.html"><a href="final-project.html"><i class="fa fa-check"></i><b>7</b> Final Project</a></li>
<li class="divider"></li>
<li><a href="./">by ZIH-YING, LI</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Recommender System</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="collaborative-filtering" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Sec 5</span> Collaborative filtering<a href="collaborative-filtering.html#collaborative-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>Collaborative filtering (協同過濾)</em> 會考慮到不同使用者的資訊，其演算法基於<strong>“使用者 (user)”和”物件 (item)“的相似性</strong>，用於計算的資料為矩陣形式，其中列 (row) 為 user、行 (column) 為 item，對應的值為 rating。
這個矩陣通常會是<strong>稀疏 (sparse)</strong> 的，尤其是物件很多的情況下，大部分使用者只會買其中幾項，因此這個矩陣會非常龐大且稀疏。</p>
<p>協同過濾的概念很像<strong>對遺失值進行插補</strong>，因我我們的目的是推薦物品給還未對該物品進行評分的使用者。以電影來說，我們希望推薦使用者它還未看過但可能會感興趣的電影。</p>
<h4>
訓練及測試
</h4>
<p>通常在建模的時候會把資料分為<strong>訓練集和測試集</strong>來檢查模型是否有問題，但在<strong>協同過濾中這是比較沒有必要</strong>的。
因為前面提到過其概念很像補遺失值，那麼就不會有只補一部份資料的情況。
另外對協同過濾來說沒有實際的”新使用者”，因為新使用者不會有評分的資訊，就沒辦法被推薦。如果已經有評分的資訊，那不如也納進訓練裡來增加樣本，所以沒有必要再拆分資料。</p>
<p><strong>預測</strong>的結果會是使用者接受推薦與否，也就是成功或失敗，因此我們能得到一個混淆矩陣:</p>
<table>
<tbody>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center">True</td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center">1 (Positive)</td>
<td align="center">0 (Negative)</td>
</tr>
<tr class="odd">
<td align="center">Pred.</td>
<td align="center">1</td>
<td align="center">TP</td>
<td align="center">FP</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center">0</td>
<td align="center">FN</td>
<td align="center">TN</td>
</tr>
</tbody>
</table>
<p>我們會比較專注在<strong>“FP”</strong>的部分，因為預測它是1表示它和1的那群很相似，所以要推薦或是建議給它。混淆矩陣可以計算很多指標，因為我們會比較在意成功，所以<strong>召回率</strong>比較重要，舉例來說在路上發傳單，會專注在收了傳單且有來的人。</p>
<h4>
相似性(similarity)
</h4>
<ul>
<li><strong>pearson (皮爾森相關係數)</strong>: <span class="math inline">\(m_{pearson(x,y)}=\frac1n\sum(\frac{X-\bar X}{s_X})(\frac{Y-\bar Y}{s_Y})\)</span></li>
<li><strong>cosine</strong>: <span class="math inline">\(m_{cosine}=\frac{X\cdot Y}{||X||\cdot||Y||}\)</span></li>
<li><strong>jacard</strong> (二元資料適合使用): <span class="math inline">\(J(X,Y)=\frac{|A\cap B|}{|A\cup B|}=\frac{|A\cap B|}{|A|+|B|-|A\cap B|}\)</span></li>
</ul>
<h4>
演算法
</h4>
<ul>
<li><a href="collaborative-filtering.html#IBCF">Item-based collaborative filtering (IBCF)</a>: 識別同個使用者購買過的物品，推薦相似的物品
<ul>
<li><strong>根據相似矩陣</strong>推薦項目，一旦建立了模型，就不需要訪問原始資料</li>
<li>對於每個項目，模型<strong>存儲了 k 個最相似</strong>的項目，因此一旦建立了模型，信息量就很小，這在在大量資料下是一個優勢</li>
</ul></li>
<li><a href="collaborative-filtering.html#UBCF">User-based collaborative filtering (UBCF)</a>: 識別相似的使用者，推薦相似使用者購買過的最高評分的物品
<ul>
<li>需要訪問<strong>所有的資料</strong>來進行預測，因此大資料不太合適</li>
<li>UBCF的正確率比IBCF稍微高些，因此如果資料不是太大，UBCF是個不錯的選擇</li>
</ul></li>
</ul>
<h4>
限制
</h4>
<p>在處理新的使用者或是物品時，這個演算法會有以下的問題，以電影評分為例:</p>
<ul>
<li>如果新的使用者沒有看過任何電影，IBCF和UBCF都沒辦法推薦，因為兩種演算法的預測都需要基於使用者已經評過分的資訊</li>
<li>如果新的電影沒有被任何人觀看，那它永遠不會被推薦。</li>
<li>該演算法僅使用評分矩陣，但有可能有其他的資訊可以改善推薦，因此有了其他新方法</li>
</ul>
<h4>
延伸: <em>Content-based filtering</em>
</h4>
<p>該演算法以對<strong>物品的描述</strong>為開始且<strong>不需要考慮到其他使用者</strong>，而是推薦和使用者<strong>過去購買的物品相似</strong>的物品</p>
<p>步驟:</p>
<ol style="list-style-type: decimal">
<li>定義物品的描述</li>
<li>基於購買紀錄定義使用者檔案</li>
<li>推薦和使用者檔案相符的物品</li>
</ol>
<h4>
延伸: <em>Hybrid recommender systems</em>
</h4>
<p>在很多情況下，我們會建立很多不同的模型，在機器學習中<strong>結合不同模型的結果</strong>通常會有較好的結果。
可以是平行運算(每個模型分開跑，在綜合結果)或是序列運算(前一個模型的結果是後一個模型的輸入)。</p>
<p>一個簡單的例子是協同過濾<strong>結合有關用戶或物品的信息</strong>。在IBCF的情況下，物品之間的距離可以同時考慮用戶的偏好和物品的描述。即使在UBCF中，用戶之間的距離也可以考慮他們的偏好和個人數據。</p>
<br>
<div class="header-moon">
<h2>
Preview
</h2>
</div>
<p><br></p>
<ol style="list-style-type: decimal">
<li><code>realRatingMatrix</code>類型可用的方法、<code>Pander</code>呈現矩陣</li>
<li><code>realRatingMatrix</code>和<code>Matrix</code>的儲存空間差異</li>
<li>計算相似矩陣，分為user之間和item之間</li>
<li><code>recommenderRegistry$get_entries(dataType = "realRatingMatrix")</code>: 顯示可用的模型</li>
<li>EDA (Exploratory Data Analysis)</li>
<li>Example: Movie<br />
6.1: IBCF<br />
6.2: UBCF</li>
</ol>
<ul>
<li>Note:
<ul>
<li><code>recommenderlab::binarize</code>中的<code>minRating</code>參數設定的是被判斷是否為1的最低評分，而不是item被評分的次數。 假設<code>minRating=3</code>，則3(含)以上為1，其它為0 (範例: <a href="collaborative-filtering.html#binarization">Binarization</a>)</li>
</ul></li>
</ul>
<hr />
<div id="methods-for-realratingmatrix-class" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Methods for “realRatingMatrix” Class<a href="collaborative-filtering.html#methods-for-realratingmatrix-class" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li class="downarrow">
列出所有 S3 和 S4 generic function 可用的方法
</li>
</ul>
<pre><code>methods(generic.function, class)</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="collaborative-filtering.html#cb195-1" tabindex="-1"></a>temp<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">&quot;data/MovieLense.csv&quot;</span>) </span>
<span id="cb195-2"><a href="collaborative-filtering.html#cb195-2" tabindex="-1"></a></span>
<span id="cb195-3"><a href="collaborative-filtering.html#cb195-3" tabindex="-1"></a><span class="fu">library</span>(recommenderlab)</span>
<span id="cb195-4"><a href="collaborative-filtering.html#cb195-4" tabindex="-1"></a>MovieLense<span class="ot">=</span><span class="fu">as</span>(temp,<span class="st">&quot;realRatingMatrix&quot;</span>)</span>
<span id="cb195-5"><a href="collaborative-filtering.html#cb195-5" tabindex="-1"></a>DF<span class="ot">=</span><span class="fu">getData.frame</span>(MovieLense)</span></code></pre></div>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="collaborative-filtering.html#cb196-1" tabindex="-1"></a>methods_matrix <span class="ot">&lt;-</span> <span class="fu">methods</span>(<span class="at">class =</span> <span class="fu">class</span>(MovieLense))</span>
<span id="cb196-2"><a href="collaborative-filtering.html#cb196-2" tabindex="-1"></a>methods_matrix</span></code></pre></div>
<pre><code>##  [1] [                      [&lt;-                    binarize              
##  [4] calcPredictionAccuracy coerce                 colCounts             
##  [7] colMeans               colSds                 colSums               
## [10] denormalize            dim                    dimnames              
## [13] dimnames&lt;-             dissimilarity          evaluationScheme      
## [16] getData.frame          getList                getNormalize          
## [19] getRatingMatrix        getRatings             getTopNLists          
## [22] hasRating              image                  normalize             
## [25] nratings               Recommender            removeKnownRatings    
## [28] rowCounts              rowMeans               rowSds                
## [31] rowSums                sample                 show                  
## [34] similarity            
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<ul>
<li class="downarrow">
使用pander，以矩陣呈現
</li>
</ul>
<ol style="list-style-type: decimal">
<li>使用函數<code>pander(x = NULL, ...)</code></li>
</ol>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="collaborative-filtering.html#cb198-1" tabindex="-1"></a>methods_to_print <span class="ot">&lt;-</span> <span class="fu">as.character</span>(methods_matrix)</span>
<span id="cb198-2"><a href="collaborative-filtering.html#cb198-2" tabindex="-1"></a>methods_to_print <span class="ot">&lt;-</span> methods_to_print[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;coerce&quot;</span>, methods_to_print)]</span>
<span id="cb198-3"><a href="collaborative-filtering.html#cb198-3" tabindex="-1"></a>methods_to_print <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;,.*&quot;</span>, <span class="st">&quot;&quot;</span>, methods_to_print, <span class="at">perl =</span> <span class="cn">TRUE</span>)</span>
<span id="cb198-4"><a href="collaborative-filtering.html#cb198-4" tabindex="-1"></a>methods_to_print <span class="ot">&lt;-</span> <span class="fu">c</span>(methods_to_print, <span class="st">&quot;&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="co"># 湊齊才能用矩陣</span></span>
<span id="cb198-5"><a href="collaborative-filtering.html#cb198-5" tabindex="-1"></a></span>
<span id="cb198-6"><a href="collaborative-filtering.html#cb198-6" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb198-7"><a href="collaborative-filtering.html#cb198-7" tabindex="-1"></a>pander<span class="sc">::</span><span class="fu">pander</span>(<span class="fu">matrix</span>(methods_to_print, <span class="at">ncol =</span> <span class="dv">3</span>))</span></code></pre></div>
<table style="width:90%;">
<colgroup>
<col width="34%" />
<col width="26%" />
<col width="29%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="center">[</td>
<td align="center">dimnames&lt;-</td>
<td align="center">nratings</td>
</tr>
<tr class="even">
<td align="center">[&lt;-</td>
<td align="center">dissimilarity</td>
<td align="center">Recommender</td>
</tr>
<tr class="odd">
<td align="center">binarize</td>
<td align="center">evaluationScheme</td>
<td align="center">removeKnownRatings</td>
</tr>
<tr class="even">
<td align="center">calcPredictionAccuracy</td>
<td align="center">getData.frame</td>
<td align="center">rowCounts</td>
</tr>
<tr class="odd">
<td align="center">calcPredictionAccuracy</td>
<td align="center">getList</td>
<td align="center">rowMeans</td>
</tr>
<tr class="even">
<td align="center">colCounts</td>
<td align="center">getNormalize</td>
<td align="center">rowSds</td>
</tr>
<tr class="odd">
<td align="center">colMeans</td>
<td align="center">getRatingMatrix</td>
<td align="center">rowSums</td>
</tr>
<tr class="even">
<td align="center">colSds</td>
<td align="center">getRatings</td>
<td align="center">sample</td>
</tr>
<tr class="odd">
<td align="center">colSums</td>
<td align="center">getTopNLists</td>
<td align="center">show</td>
</tr>
<tr class="even">
<td align="center">denormalize</td>
<td align="center">hasRating</td>
<td align="center">similarity</td>
</tr>
<tr class="odd">
<td align="center">dim</td>
<td align="center">image</td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center">dimnames</td>
<td align="center">normalize</td>
<td align="center"></td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>使用<code>r</code>code chunk</li>
</ol>
<div class="sourceCode" id="cb199"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb199-1"><a href="collaborative-filtering.html#cb199-1" tabindex="-1"></a>```{{r render=pander, results=&#39;asis&#39;}}</span>
<span id="cb199-2"><a href="collaborative-filtering.html#cb199-2" tabindex="-1"></a>matrix(methods_to_print, ncol = 3)</span>
<span id="cb199-3"><a href="collaborative-filtering.html#cb199-3" tabindex="-1"></a>```</span></code></pre></div>
<table style="width:90%;">
<colgroup>
<col width="34%" />
<col width="26%" />
<col width="29%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="center">[</td>
<td align="center">dimnames&lt;-</td>
<td align="center">nratings</td>
</tr>
<tr class="even">
<td align="center">[&lt;-</td>
<td align="center">dissimilarity</td>
<td align="center">Recommender</td>
</tr>
<tr class="odd">
<td align="center">binarize</td>
<td align="center">evaluationScheme</td>
<td align="center">removeKnownRatings</td>
</tr>
<tr class="even">
<td align="center">calcPredictionAccuracy</td>
<td align="center">getData.frame</td>
<td align="center">rowCounts</td>
</tr>
<tr class="odd">
<td align="center">calcPredictionAccuracy</td>
<td align="center">getList</td>
<td align="center">rowMeans</td>
</tr>
<tr class="even">
<td align="center">colCounts</td>
<td align="center">getNormalize</td>
<td align="center">rowSds</td>
</tr>
<tr class="odd">
<td align="center">colMeans</td>
<td align="center">getRatingMatrix</td>
<td align="center">rowSums</td>
</tr>
<tr class="even">
<td align="center">colSds</td>
<td align="center">getRatings</td>
<td align="center">sample</td>
</tr>
<tr class="odd">
<td align="center">colSums</td>
<td align="center">getTopNLists</td>
<td align="center">show</td>
</tr>
<tr class="even">
<td align="center">denormalize</td>
<td align="center">hasRating</td>
<td align="center">similarity</td>
</tr>
<tr class="odd">
<td align="center">dim</td>
<td align="center">image</td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center">dimnames</td>
<td align="center">normalize</td>
<td align="center"></td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="compare-the-storage-sizes" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Compare the storage sizes<a href="collaborative-filtering.html#compare-the-storage-sizes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li class="downarrow">
回傳物件分配的空間
</li>
</ul>
<pre><code>object.size(x)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Class</th>
<th align="left">object size (bytes)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">data.frame</td>
<td align="left">1725248</td>
</tr>
<tr class="even">
<td align="left">realRatingMatrix</td>
<td align="left">1409432</td>
</tr>
<tr class="odd">
<td align="left">matrix, array</td>
<td align="left">12761360</td>
</tr>
</tbody>
</table>
<p>可以看到<code>recommenderlab</code>的矩陣更簡潔，兩者差了9.05倍</p>
<hr />
</div>
<div id="computie-similarity-matrix" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Computie Similarity Matrix<a href="collaborative-filtering.html#computie-similarity-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li class="downarrow">
{recommenderlab} 計算評分的相似性
</li>
</ul>
<pre><code>similarity(x, y = NULL, method = NULL, args = NULL, which = &quot;users&quot;,
  min_matching = 0, min_predictive = 0)</code></pre>
<ul>
<li><code>method</code>: “cosine”, “pearson”, “jaccard”, etc.</li>
<li><code>which</code>: 計算”users”(rows)或”items”(columns)之間的相似性</li>
<li><code>min_matching</code>: 最小評分數的閾值</li>
</ul>
<ul>
<li class="downarrow">
使用者相似性
</li>
</ul>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="collaborative-filtering.html#cb202-1" tabindex="-1"></a>similarity_users <span class="ot">&lt;-</span> <span class="fu">similarity</span>(MovieLense[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, ], <span class="at">method =</span> <span class="st">&quot;cosine&quot;</span>, <span class="at">which =</span> <span class="st">&quot;users&quot;</span>)</span>
<span id="cb202-2"><a href="collaborative-filtering.html#cb202-2" tabindex="-1"></a><span class="fu">class</span>(similarity_users)</span></code></pre></div>
<pre><code>## [1] &quot;simil&quot; &quot;dist&quot;</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="collaborative-filtering.html#cb204-1" tabindex="-1"></a>similarity_users_as_matrix<span class="ot">=</span><span class="fu">as.matrix</span>(similarity_users)</span>
<span id="cb204-2"><a href="collaborative-filtering.html#cb204-2" tabindex="-1"></a></span>
<span id="cb204-3"><a href="collaborative-filtering.html#cb204-3" tabindex="-1"></a>similarity_users_as_matrix[<span class="fu">nrow</span>(similarity_users_as_matrix)<span class="sc">:</span><span class="dv">1</span>,] <span class="sc">|&gt;</span> </span>
<span id="cb204-4"><a href="collaborative-filtering.html#cb204-4" tabindex="-1"></a>  pander<span class="sc">::</span><span class="fu">pander</span>(<span class="at">plain.ascii =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table style="width:75%;">
<colgroup>
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5</td>
<td align="center">0.9663</td>
<td align="center">0.9924</td>
<td align="center">1</td>
<td align="center">0.9973</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td>4</td>
<td align="center">0.9596</td>
<td align="center">0.9685</td>
<td align="center">0.9565</td>
<td align="center">NA</td>
<td align="center">0.9973</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="center">0.917</td>
<td align="center">0.9634</td>
<td align="center">NA</td>
<td align="center">0.9565</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">0.9803</td>
<td align="center">NA</td>
<td align="center">0.9634</td>
<td align="center">0.9685</td>
<td align="center">0.9924</td>
</tr>
<tr class="odd">
<td>1</td>
<td align="center">NA</td>
<td align="center">0.9803</td>
<td align="center">0.917</td>
<td align="center">0.9596</td>
<td align="center">0.9663</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="collaborative-filtering.html#cb205-1" tabindex="-1"></a><span class="fu">image</span>(similarity_users_as_matrix, <span class="at">main =</span> <span class="st">&quot;User similarity&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-124-1.png" width="1152" style="display: block; margin: auto;" /></p>
<ul>
<li class="downarrow">
物品相似性
</li>
</ul>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="collaborative-filtering.html#cb206-1" tabindex="-1"></a>similarity_items <span class="ot">&lt;-</span> <span class="fu">similarity</span>(MovieLense[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">method =</span> <span class="st">&quot;cosine&quot;</span>, <span class="at">which =</span> <span class="st">&quot;items&quot;</span>)</span>
<span id="cb206-2"><a href="collaborative-filtering.html#cb206-2" tabindex="-1"></a>similarity_items_as_matrix<span class="ot">=</span><span class="fu">as.matrix</span>(similarity_items)</span>
<span id="cb206-3"><a href="collaborative-filtering.html#cb206-3" tabindex="-1"></a></span>
<span id="cb206-4"><a href="collaborative-filtering.html#cb206-4" tabindex="-1"></a>similarity_items_as_matrix[<span class="fu">nrow</span>(similarity_items_as_matrix)<span class="sc">:</span><span class="dv">1</span>,] <span class="sc">|&gt;</span> </span>
<span id="cb206-5"><a href="collaborative-filtering.html#cb206-5" tabindex="-1"></a>  pander<span class="sc">::</span><span class="fu">pander</span>(<span class="at">digits =</span> <span class="dv">2</span>, <span class="at">plain.ascii =</span> <span class="cn">TRUE</span>, <span class="at">split.cells=</span><span class="dv">12</span>)</span></code></pre></div>
<table>
<colgroup>
<col width="17%" />
<col width="15%" />
<col width="17%" />
<col width="15%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th align="center">’Til There
Was You
(1997)</th>
<th align="center">1-900 (1994)</th>
<th align="center">101
Dalmatians
(1996)</th>
<th align="center">12 Angry Men
(1957)</th>
<th align="center">187 (1997)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>187
(1997)</td>
<td align="center">0.98</td>
<td align="center">1</td>
<td align="center">0.94</td>
<td align="center">1</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td>12 Angry
Men (1957)</td>
<td align="center">0.99</td>
<td align="center">1</td>
<td align="center">0.95</td>
<td align="center">NA</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td>101
Dalmatians
(1996)</td>
<td align="center">0.8</td>
<td align="center">1</td>
<td align="center">NA</td>
<td align="center">0.95</td>
<td align="center">0.94</td>
</tr>
<tr class="even">
<td>1-900
(1994)</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td>’Til There
Was You
(1997)</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">0.8</td>
<td align="center">0.99</td>
<td align="center">0.98</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="collaborative-filtering.html#cb207-1" tabindex="-1"></a><span class="fu">image</span>(similarity_items_as_matrix, <span class="at">main =</span> <span class="st">&quot;Item similarity&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-125-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="collaborative-filtering.html#cb208-1" tabindex="-1"></a>add.text <span class="ot">&lt;-</span> <span class="cf">function</span>(simil){</span>
<span id="cb208-2"><a href="collaborative-filtering.html#cb208-2" tabindex="-1"></a>  val <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">as.vector</span>(simil),<span class="dv">2</span>)</span>
<span id="cb208-3"><a href="collaborative-filtering.html#cb208-3" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb208-4"><a href="collaborative-filtering.html#cb208-4" tabindex="-1"></a>    <span class="at">val=</span><span class="fu">c</span>(val, <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">5</span>)), </span>
<span id="cb208-5"><a href="collaborative-filtering.html#cb208-5" tabindex="-1"></a>    <span class="at">x=</span><span class="fu">c</span>(<span class="fu">seq</span>(.<span class="dv">25</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">25</span>),<span class="fu">seq</span>(.<span class="dv">25</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">25</span>)[<span class="sc">-</span><span class="dv">1</span>],<span class="fu">seq</span>(.<span class="dv">25</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">25</span>)[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)],<span class="fu">seq</span>(.<span class="dv">25</span>,<span class="dv">1</span>,<span class="at">by=</span>.<span class="dv">25</span>)[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)],</span>
<span id="cb208-6"><a href="collaborative-filtering.html#cb208-6" tabindex="-1"></a>        <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out=</span><span class="dv">5</span>)), </span>
<span id="cb208-7"><a href="collaborative-filtering.html#cb208-7" tabindex="-1"></a>    <span class="at">y=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>),<span class="fu">rep</span>(.<span class="dv">25</span>,<span class="dv">3</span>),<span class="fu">rep</span>(.<span class="dv">5</span>,<span class="dv">2</span>),<span class="fu">rep</span>(.<span class="dv">75</span>,<span class="dv">1</span>),</span>
<span id="cb208-8"><a href="collaborative-filtering.html#cb208-8" tabindex="-1"></a>        <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out=</span><span class="dv">5</span>)),</span>
<span id="cb208-9"><a href="collaborative-filtering.html#cb208-9" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">c</span>(<span class="fu">ifelse</span>(val<span class="sc">&gt;</span><span class="fl">0.97</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>), <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">5</span>))</span>
<span id="cb208-10"><a href="collaborative-filtering.html#cb208-10" tabindex="-1"></a>  )</span>
<span id="cb208-11"><a href="collaborative-filtering.html#cb208-11" tabindex="-1"></a>  <span class="fu">text</span>(tmp<span class="sc">$</span>x, tmp<span class="sc">$</span>y, tmp<span class="sc">$</span>val, <span class="at">col=</span>tmp<span class="sc">$</span>col)</span>
<span id="cb208-12"><a href="collaborative-filtering.html#cb208-12" tabindex="-1"></a>}</span>
<span id="cb208-13"><a href="collaborative-filtering.html#cb208-13" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb208-14"><a href="collaborative-filtering.html#cb208-14" tabindex="-1"></a><span class="fu">image</span>(similarity_users_as_matrix, <span class="at">main =</span> <span class="st">&quot;User similarity&quot;</span>)</span>
<span id="cb208-15"><a href="collaborative-filtering.html#cb208-15" tabindex="-1"></a><span class="fu">add.text</span>(similarity_users)</span>
<span id="cb208-16"><a href="collaborative-filtering.html#cb208-16" tabindex="-1"></a><span class="fu">image</span>(similarity_items_as_matrix, <span class="at">main =</span> <span class="st">&quot;Item similarity&quot;</span>)</span>
<span id="cb208-17"><a href="collaborative-filtering.html#cb208-17" tabindex="-1"></a><span class="fu">add.text</span>(similarity_items)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-126-1.png" width="1152" style="display: block; margin: auto;" /></p>
<hr />
</div>
<div id="recommender-model" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Recommender Model<a href="collaborative-filtering.html#recommender-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="collaborative-filtering.html#cb209-1" tabindex="-1"></a>recommender_models <span class="ot">&lt;-</span> recommenderRegistry<span class="sc">$</span><span class="fu">get_entries</span>(<span class="at">dataType =</span> <span class="st">&quot;realRatingMatrix&quot;</span>)</span>
<span id="cb209-2"><a href="collaborative-filtering.html#cb209-2" tabindex="-1"></a><span class="fu">names</span>(recommender_models)</span></code></pre></div>
<pre><code>##  [1] &quot;HYBRID_realRatingMatrix&quot;       &quot;ALS_realRatingMatrix&quot;         
##  [3] &quot;ALS_implicit_realRatingMatrix&quot; &quot;IBCF_realRatingMatrix&quot;        
##  [5] &quot;LIBMF_realRatingMatrix&quot;        &quot;POPULAR_realRatingMatrix&quot;     
##  [7] &quot;RANDOM_realRatingMatrix&quot;       &quot;RERECOMMEND_realRatingMatrix&quot; 
##  [9] &quot;SVD_realRatingMatrix&quot;          &quot;SVDF_realRatingMatrix&quot;        
## [11] &quot;UBCF_realRatingMatrix&quot;</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="collaborative-filtering.html#cb211-1" tabindex="-1"></a><span class="fu">lapply</span>(recommender_models, <span class="st">&quot;[[&quot;</span>, <span class="st">&quot;description&quot;</span>)</span></code></pre></div>
<pre><code>## $HYBRID_realRatingMatrix
## [1] &quot;Hybrid recommender that aggegates several recommendation strategies using weighted averages.&quot;
## 
## $ALS_realRatingMatrix
## [1] &quot;Recommender for explicit ratings based on latent factors, calculated by alternating least squares algorithm.&quot;
## 
## $ALS_implicit_realRatingMatrix
## [1] &quot;Recommender for implicit data based on latent factors, calculated by alternating least squares algorithm.&quot;
## 
## $IBCF_realRatingMatrix
## [1] &quot;Recommender based on item-based collaborative filtering.&quot;
## 
## $LIBMF_realRatingMatrix
## [1] &quot;Matrix factorization with LIBMF via package recosystem (https://cran.r-project.org/web/packages/recosystem/vignettes/introduction.html).&quot;
## 
## $POPULAR_realRatingMatrix
## [1] &quot;Recommender based on item popularity.&quot;
## 
## $RANDOM_realRatingMatrix
## [1] &quot;Produce random recommendations (real ratings).&quot;
## 
## $RERECOMMEND_realRatingMatrix
## [1] &quot;Re-recommends highly rated items (real ratings).&quot;
## 
## $SVD_realRatingMatrix
## [1] &quot;Recommender based on SVD approximation with column-mean imputation.&quot;
## 
## $SVDF_realRatingMatrix
## [1] &quot;Recommender based on Funk SVD with gradient descend (https://sifter.org/~simon/journal/20061211.html).&quot;
## 
## $UBCF_realRatingMatrix
## [1] &quot;Recommender based on user-based collaborative filtering.&quot;</code></pre>
<hr />
<ul>
<li class="downarrow">
extraction function
</li>
</ul>
<pre><code>&quot;[[&quot;</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="collaborative-filtering.html#cb214-1" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">b=</span>letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb214-2"><a href="collaborative-filtering.html#cb214-2" tabindex="-1"></a>test</span></code></pre></div>
<pre><code>## $a
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## $b
##  [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot;</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="collaborative-filtering.html#cb216-1" tabindex="-1"></a> <span class="st">&quot;[[&quot;</span>(test,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="collaborative-filtering.html#cb218-1" tabindex="-1"></a> <span class="st">&quot;[&quot;</span>(test,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## $a
##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<hr />
<p>我們只使用IBCF(item-based collaborative filtering)和UBCF(user-based collaborative filtering)</p>
<ul>
<li class="downarrow">
查看參數
</li>
</ul>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="collaborative-filtering.html#cb220-1" tabindex="-1"></a>df_parameters <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb220-2"><a href="collaborative-filtering.html#cb220-2" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="fu">names</span>(recommender_models<span class="sc">$</span>IBCF_realRatingMatrix<span class="sc">$</span>parameters),</span>
<span id="cb220-3"><a href="collaborative-filtering.html#cb220-3" tabindex="-1"></a>  <span class="at">default =</span> <span class="fu">unlist</span>(recommender_models<span class="sc">$</span>IBCF_realRatingMatrix<span class="sc">$</span>parameters),</span>
<span id="cb220-4"><a href="collaborative-filtering.html#cb220-4" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">NULL</span></span>
<span id="cb220-5"><a href="collaborative-filtering.html#cb220-5" tabindex="-1"></a>)</span>
<span id="cb220-6"><a href="collaborative-filtering.html#cb220-6" tabindex="-1"></a>df_parameters <span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:left;">
default
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
k
</td>
<td style="text-align:left;">
30
</td>
</tr>
<tr>
<td style="text-align:left;">
method
</td>
<td style="text-align:left;">
cosine
</td>
</tr>
<tr>
<td style="text-align:left;">
normalize
</td>
<td style="text-align:left;">
center
</td>
</tr>
<tr>
<td style="text-align:left;">
normalize_sim_matrix
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha
</td>
<td style="text-align:left;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
na_as_zero
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="exploratory-data-analysis" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Exploratory Data Analysis<a href="collaborative-filtering.html#exploratory-data-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="collaborative-filtering.html#cb221-1" tabindex="-1"></a><span class="fu">dim</span>(MovieLense)</span></code></pre></div>
<pre><code>## [1]  943 1664</code></pre>
<p>MovieLense包含943個users和1664部電影</p>
<ul>
<li><code>realRatingMatrix</code>屬於S4類別(class)，要用<code>slotNames</code>取得內容名稱</li>
</ul>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="collaborative-filtering.html#cb223-1" tabindex="-1"></a><span class="fu">slotNames</span>(MovieLense)</span></code></pre></div>
<pre><code>## [1] &quot;data&quot;      &quot;normalize&quot;</code></pre>
<ul>
<li><code>MovieLense@data</code>屬於<code>dgCMatrix</code>類別，屬於稀疏數值矩陣(sparse numeric matrices)</li>
</ul>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="collaborative-filtering.html#cb225-1" tabindex="-1"></a><span class="fu">class</span>(MovieLense<span class="sc">@</span>data)</span></code></pre></div>
<pre><code>## [1] &quot;dgCMatrix&quot;
## attr(,&quot;package&quot;)
## [1] &quot;Matrix&quot;</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="collaborative-filtering.html#cb227-1" tabindex="-1"></a><span class="fu">dim</span>(MovieLense<span class="sc">@</span>data)</span></code></pre></div>
<pre><code>## [1]  943 1664</code></pre>
<ul>
<li class="downarrow">
評分為整數，範圍為0~5
</li>
</ul>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="collaborative-filtering.html#cb229-1" tabindex="-1"></a>vector_ratings <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(MovieLense<span class="sc">@</span>data)</span>
<span id="cb229-2"><a href="collaborative-filtering.html#cb229-2" tabindex="-1"></a><span class="fu">unique</span>(vector_ratings) <span class="sc">|&gt;</span> <span class="fu">sort</span>()</span></code></pre></div>
<pre><code>## [1] 0 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="collaborative-filtering.html#cb231-1" tabindex="-1"></a>table_ratings <span class="ot">&lt;-</span> <span class="fu">table</span>(vector_ratings)</span>
<span id="cb231-2"><a href="collaborative-filtering.html#cb231-2" tabindex="-1"></a>df_ratings <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb231-3"><a href="collaborative-filtering.html#cb231-3" tabindex="-1"></a>  <span class="at">rating =</span> <span class="fu">names</span>(table_ratings),</span>
<span id="cb231-4"><a href="collaborative-filtering.html#cb231-4" tabindex="-1"></a>  <span class="at">occurrences =</span> <span class="fu">as.vector</span>(table_ratings)</span>
<span id="cb231-5"><a href="collaborative-filtering.html#cb231-5" tabindex="-1"></a>)</span>
<span id="cb231-6"><a href="collaborative-filtering.html#cb231-6" tabindex="-1"></a>df_ratings <span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
rating
</th>
<th style="text-align:right;">
occurrences
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
1469760
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
6059
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
11307
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
27002
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
33947
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
21077
</td>
</tr>
</tbody>
</table>
<ul>
<li class="downarrow">
評分為0表示遺失值，因此移除它
</li>
</ul>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="collaborative-filtering.html#cb232-1" tabindex="-1"></a><span class="fu">length</span>(vector_ratings)</span>
<span id="cb232-2"><a href="collaborative-filtering.html#cb232-2" tabindex="-1"></a>vector_ratings <span class="ot">&lt;-</span> vector_ratings[vector_ratings <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb232-3"><a href="collaborative-filtering.html#cb232-3" tabindex="-1"></a><span class="fu">length</span>(vector_ratings)</span></code></pre></div>
<pre><code>## [1] 1569152
## [1] 99392</code></pre>
<div id="rating" class="section level3 hasAnchor" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Rating<a href="collaborative-filtering.html#rating" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li class="downarrow">
大多數評分都大於2，最常見的評分為4
</li>
</ul>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="collaborative-filtering.html#cb234-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb234-2"><a href="collaborative-filtering.html#cb234-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(vector_ratings), <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(vector_ratings)))<span class="sc">+</span></span>
<span id="cb234-3"><a href="collaborative-filtering.html#cb234-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb234-4"><a href="collaborative-filtering.html#cb234-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribution of the ratings&quot;</span>,</span>
<span id="cb234-5"><a href="collaborative-filtering.html#cb234-5" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Ratings&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-135-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="movie-views" class="section level3 hasAnchor" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> Movie views<a href="collaborative-filtering.html#movie-views" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li class="downarrow">
Star Wars有最高的觀看數
</li>
</ul>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="collaborative-filtering.html#cb235-1" tabindex="-1"></a>views_per_movie <span class="ot">&lt;-</span> <span class="fu">colCounts</span>(MovieLense)</span>
<span id="cb235-2"><a href="collaborative-filtering.html#cb235-2" tabindex="-1"></a>table_views <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb235-3"><a href="collaborative-filtering.html#cb235-3" tabindex="-1"></a>  <span class="at">movie =</span> <span class="fu">names</span>(views_per_movie),</span>
<span id="cb235-4"><a href="collaborative-filtering.html#cb235-4" tabindex="-1"></a>  <span class="at">views =</span> views_per_movie</span>
<span id="cb235-5"><a href="collaborative-filtering.html#cb235-5" tabindex="-1"></a>  )</span>
<span id="cb235-6"><a href="collaborative-filtering.html#cb235-6" tabindex="-1"></a>table_views <span class="ot">&lt;-</span> table_views[<span class="fu">order</span>(table_views<span class="sc">$</span>views, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb235-7"><a href="collaborative-filtering.html#cb235-7" tabindex="-1"></a></span>
<span id="cb235-8"><a href="collaborative-filtering.html#cb235-8" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">head</span>(table_views), <span class="fu">aes</span>(<span class="at">x=</span>movie, <span class="at">y=</span>views))<span class="sc">+</span></span>
<span id="cb235-9"><a href="collaborative-filtering.html#cb235-9" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb235-10"><a href="collaborative-filtering.html#cb235-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb235-11"><a href="collaborative-filtering.html#cb235-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of views of the top movies&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-136-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="average-ratings" class="section level3 hasAnchor" number="5.5.3">
<h3><span class="header-section-number">5.5.3</span> Average ratings<a href="collaborative-filtering.html#average-ratings" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li class="downarrow">
大部分電影的平均評分在3左右，其中有些評分為1或5，可能是因為只有少數人評分
</li>
</ul>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="collaborative-filtering.html#cb236-1" tabindex="-1"></a>average_ratings <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(MovieLense)</span>
<span id="cb236-2"><a href="collaborative-filtering.html#cb236-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(average_ratings), <span class="fu">aes</span>(<span class="at">x=</span>average_ratings))<span class="sc">+</span></span>
<span id="cb236-3"><a href="collaborative-filtering.html#cb236-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb236-4"><a href="collaborative-filtering.html#cb236-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribution of the average movie rating&quot;</span>,</span>
<span id="cb236-5"><a href="collaborative-filtering.html#cb236-5" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Average Ratings&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-137-1.png" width="1152" style="display: block; margin: auto;" /></p>
<ul>
<li class="downarrow">
因此我們應該保留大部分人都有評分的電影，保留超過100人觀看的電影，共332部
</li>
</ul>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="collaborative-filtering.html#cb237-1" tabindex="-1"></a><span class="fu">summary</span>(views_per_movie)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##       1       7      27      60      80     583</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="collaborative-filtering.html#cb239-1" tabindex="-1"></a>average_ratings_relevant <span class="ot">&lt;-</span> average_ratings[views_per_movie <span class="sc">&gt;</span> <span class="dv">100</span>]</span>
<span id="cb239-2"><a href="collaborative-filtering.html#cb239-2" tabindex="-1"></a><span class="fu">length</span>(average_ratings_relevant)</span></code></pre></div>
<pre><code>## [1] 332</code></pre>
<ul>
<li class="downarrow">
移除極端值後，大部分電影的平均評分在4左右
</li>
</ul>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="collaborative-filtering.html#cb241-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(average_ratings_relevant), <span class="fu">aes</span>(<span class="at">x=</span>average_ratings_relevant))<span class="sc">+</span></span>
<span id="cb241-2"><a href="collaborative-filtering.html#cb241-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()<span class="sc">+</span></span>
<span id="cb241-3"><a href="collaborative-filtering.html#cb241-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribution of the relevant average ratings&quot;</span>,</span>
<span id="cb241-4"><a href="collaborative-filtering.html#cb241-4" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Average Ratings for views_per_movie &gt; 100&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-139-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="rating-matrix" class="section level3 hasAnchor" number="5.5.4">
<h3><span class="header-section-number">5.5.4</span> Rating Matrix<a href="collaborative-filtering.html#rating-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li class="downarrow">
保留大多人評分的電影和評分大多電影的人
</li>
</ul>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="collaborative-filtering.html#cb242-1" tabindex="-1"></a>min_n_movies <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">rowCounts</span>(MovieLense), <span class="fl">0.99</span>)</span>
<span id="cb242-2"><a href="collaborative-filtering.html#cb242-2" tabindex="-1"></a>min_n_users <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">colCounts</span>(MovieLense), <span class="fl">0.99</span>)</span>
<span id="cb242-3"><a href="collaborative-filtering.html#cb242-3" tabindex="-1"></a><span class="fu">image</span>(MovieLense[<span class="fu">rowCounts</span>(MovieLense) <span class="sc">&gt;</span> min_n_movies,</span>
<span id="cb242-4"><a href="collaborative-filtering.html#cb242-4" tabindex="-1"></a>                 <span class="fu">colCounts</span>(MovieLense) <span class="sc">&gt;</span> min_n_users],</span>
<span id="cb242-5"><a href="collaborative-filtering.html#cb242-5" tabindex="-1"></a>                <span class="at">main =</span> <span class="st">&quot;Heatmap of the top 1% users and movies&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-140-1.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="normalize" class="section level3 hasAnchor" number="5.5.5">
<h3><span class="header-section-number">5.5.5</span> Normalize<a href="collaborative-filtering.html#normalize" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>因為評分為1~5，圖形呈現為單一色階，因此無法明顯看出電影的好壞，我們可以考慮標準化，讓評分的範圍包含負數及正數且平均為0的資料</p>
<ul>
<li>太少人看的電影可能會有偏誤(bias)</li>
<li>太少評分的使用者可能會有偏誤</li>
</ul>
<ul>
<li class="downarrow">
保留評分超過50部電影的使用者和被超過100人評分的電影
</li>
</ul>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="collaborative-filtering.html#cb243-1" tabindex="-1"></a>ratings_movies <span class="ot">&lt;-</span> MovieLense[<span class="fu">rowCounts</span>(MovieLense) <span class="sc">&gt;</span> <span class="dv">50</span>,</span>
<span id="cb243-2"><a href="collaborative-filtering.html#cb243-2" tabindex="-1"></a>                             <span class="fu">colCounts</span>(MovieLense) <span class="sc">&gt;</span> <span class="dv">100</span>]</span>
<span id="cb243-3"><a href="collaborative-filtering.html#cb243-3" tabindex="-1"></a>min_movies <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">rowCounts</span>(ratings_movies), <span class="fl">0.98</span>)</span>
<span id="cb243-4"><a href="collaborative-filtering.html#cb243-4" tabindex="-1"></a>min_users <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">colCounts</span>(ratings_movies), <span class="fl">0.98</span>)</span>
<span id="cb243-5"><a href="collaborative-filtering.html#cb243-5" tabindex="-1"></a><span class="fu">image</span>(ratings_movies[<span class="fu">rowCounts</span>(ratings_movies) <span class="sc">&gt;</span> min_movies,</span>
<span id="cb243-6"><a href="collaborative-filtering.html#cb243-6" tabindex="-1"></a>                               <span class="fu">colCounts</span>(ratings_movies) <span class="sc">&gt;</span> min_users],</span>
<span id="cb243-7"><a href="collaborative-filtering.html#cb243-7" tabindex="-1"></a>                <span class="at">main =</span> <span class="st">&quot;Heatmap of the top users and movies&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-141-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="collaborative-filtering.html#cb244-1" tabindex="-1"></a>average_ratings_per_user <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(ratings_movies)</span>
<span id="cb244-2"><a href="collaborative-filtering.html#cb244-2" tabindex="-1"></a><span class="fu">qplot</span>(average_ratings_per_user) <span class="sc">+</span></span>
<span id="cb244-3"><a href="collaborative-filtering.html#cb244-3" tabindex="-1"></a>  <span class="fu">stat_bin</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb244-4"><a href="collaborative-filtering.html#cb244-4" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Distribution of the average rating per user&quot;</span>) <span class="sc">+</span> </span>
<span id="cb244-5"><a href="collaborative-filtering.html#cb244-5" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Average ratings per user&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-141-2.png" width="1152" style="display: block; margin: auto;" /></p>
<ul>
<li class="downarrow">
Normalize
</li>
</ul>
<pre><code>normalize(x, method=&quot;center&quot;, row=TRUE)</code></pre>
<ul>
<li><code>method</code>: “center”(減平均) or “Z-score”(再除標準差)</li>
</ul>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="collaborative-filtering.html#cb246-1" tabindex="-1"></a>ratings_movies_norm <span class="ot">&lt;-</span> <span class="fu">normalize</span>(ratings_movies)</span>
<span id="cb246-2"><a href="collaborative-filtering.html#cb246-2" tabindex="-1"></a>min_movies <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">rowCounts</span>(ratings_movies), <span class="fl">0.98</span>)</span>
<span id="cb246-3"><a href="collaborative-filtering.html#cb246-3" tabindex="-1"></a>min_users <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">colCounts</span>(ratings_movies), <span class="fl">0.98</span>)</span>
<span id="cb246-4"><a href="collaborative-filtering.html#cb246-4" tabindex="-1"></a><span class="fu">image</span>(ratings_movies_norm[<span class="fu">rowCounts</span>(ratings_movies_norm) <span class="sc">&gt;</span> min_movies,</span>
<span id="cb246-5"><a href="collaborative-filtering.html#cb246-5" tabindex="-1"></a>                          <span class="fu">colCounts</span>(ratings_movies_norm) <span class="sc">&gt;</span> min_users],</span>
<span id="cb246-6"><a href="collaborative-filtering.html#cb246-6" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Heatmap of the top 2% users and movies&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-142-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="collaborative-filtering.html#cb247-1" tabindex="-1"></a>min_movies <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">rowCounts</span>(ratings_movies), <span class="fl">0.97</span>)</span>
<span id="cb247-2"><a href="collaborative-filtering.html#cb247-2" tabindex="-1"></a>min_users <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">colCounts</span>(ratings_movies), <span class="fl">0.97</span>)</span>
<span id="cb247-3"><a href="collaborative-filtering.html#cb247-3" tabindex="-1"></a><span class="fu">image</span>(ratings_movies_norm[<span class="fu">rowCounts</span>(ratings_movies_norm) <span class="sc">&gt;</span> min_movies,</span>
<span id="cb247-4"><a href="collaborative-filtering.html#cb247-4" tabindex="-1"></a>                                    <span class="fu">colCounts</span>(ratings_movies_norm) <span class="sc">&gt;</span> min_users],</span>
<span id="cb247-5"><a href="collaborative-filtering.html#cb247-5" tabindex="-1"></a>                <span class="at">main =</span> <span class="st">&quot;Heatmap of the top 3% users and movies&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-142-2.png" width="1152" style="display: block; margin: auto;" /></p>
</div>
<div id="binarization" class="section level3 hasAnchor" number="5.5.6">
<h3><span class="header-section-number">5.5.6</span> Binarization<a href="collaborative-filtering.html#binarization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="collaborative-filtering.html#cb248-1" tabindex="-1"></a>min_movies_binary <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">rowCounts</span>(ratings_movies), <span class="fl">0.95</span>)</span>
<span id="cb248-2"><a href="collaborative-filtering.html#cb248-2" tabindex="-1"></a>min_users_binary <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">colCounts</span>(ratings_movies), <span class="fl">0.95</span>)</span></code></pre></div>
<ul>
<li class="downarrow">
評分為1(含)以上為1，其餘為0
</li>
</ul>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="collaborative-filtering.html#cb249-1" tabindex="-1"></a>ratings_movies_watched <span class="ot">&lt;-</span> <span class="fu">binarize</span>(ratings_movies, <span class="at">minRating =</span> <span class="dv">1</span>)</span>
<span id="cb249-2"><a href="collaborative-filtering.html#cb249-2" tabindex="-1"></a><span class="fu">image</span>(ratings_movies_watched[<span class="fu">rowCounts</span>(ratings_movies) <span class="sc">&gt;</span> min_movies_binary,</span>
<span id="cb249-3"><a href="collaborative-filtering.html#cb249-3" tabindex="-1"></a>                             <span class="fu">colCounts</span>(ratings_movies) <span class="sc">&gt;</span> min_users_binary],</span>
<span id="cb249-4"><a href="collaborative-filtering.html#cb249-4" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Heatmap of the top 5% users and movies&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-144-1.png" width="1152" style="display: block; margin: auto;" /></p>
<ul>
<li class="downarrow">
評分為3(含)以上為1，其餘為0
</li>
</ul>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="collaborative-filtering.html#cb250-1" tabindex="-1"></a>ratings_movies_good <span class="ot">&lt;-</span> <span class="fu">binarize</span>(ratings_movies, <span class="at">minRating =</span> <span class="dv">3</span>)</span>
<span id="cb250-2"><a href="collaborative-filtering.html#cb250-2" tabindex="-1"></a><span class="fu">image</span>(ratings_movies_good[<span class="fu">rowCounts</span>(ratings_movies) <span class="sc">&gt;</span> min_movies_binary,</span>
<span id="cb250-3"><a href="collaborative-filtering.html#cb250-3" tabindex="-1"></a>                                    <span class="fu">colCounts</span>(ratings_movies) <span class="sc">&gt;</span> min_users_binary],</span>
<span id="cb250-4"><a href="collaborative-filtering.html#cb250-4" tabindex="-1"></a>                <span class="at">main =</span> <span class="st">&quot;Heatmap of the top users and movies&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-145-1.png" width="1152" style="display: block; margin: auto;" /></p>
<hr />
</div>
</div>
<div id="rating-example-movie" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> [Rating] Example: Movie<a href="collaborative-filtering.html#rating-example-movie" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="collaborative-filtering.html#cb251-1" tabindex="-1"></a><span class="fu">library</span>(recommenderlab)</span>
<span id="cb251-2"><a href="collaborative-filtering.html#cb251-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb251-3"><a href="collaborative-filtering.html#cb251-3" tabindex="-1"></a></span>
<span id="cb251-4"><a href="collaborative-filtering.html#cb251-4" tabindex="-1"></a>temp<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">&quot;data/MovieLense.csv&quot;</span>)</span>
<span id="cb251-5"><a href="collaborative-filtering.html#cb251-5" tabindex="-1"></a>MovieLense<span class="ot">=</span><span class="fu">as</span>(temp,<span class="st">&quot;realRatingMatrix&quot;</span>)</span>
<span id="cb251-6"><a href="collaborative-filtering.html#cb251-6" tabindex="-1"></a>ratings_movies <span class="ot">&lt;-</span> MovieLense[<span class="fu">rowCounts</span>(MovieLense) <span class="sc">&gt;</span> <span class="dv">50</span>,</span>
<span id="cb251-7"><a href="collaborative-filtering.html#cb251-7" tabindex="-1"></a>                             <span class="fu">colCounts</span>(MovieLense) <span class="sc">&gt;</span> <span class="dv">100</span>]</span>
<span id="cb251-8"><a href="collaborative-filtering.html#cb251-8" tabindex="-1"></a><span class="co"># ratings_movies_norm &lt;- normalize(ratings_movies)</span></span>
<span id="cb251-9"><a href="collaborative-filtering.html#cb251-9" tabindex="-1"></a><span class="fu">dim</span>(ratings_movies)</span></code></pre></div>
<pre><code>## [1] 560 332</code></pre>
<ul>
<li class="downarrow">
列出兩種演算法的參數
</li>
</ul>
<table class="kable_wrapper">
<caption>
<span id="tab:parameter-tab">Table 5.1: </span>兩種演算法的參數: IBCF(左) &amp; UBCF(右)
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:left;">
default
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
k
</td>
<td style="text-align:left;">
30
</td>
</tr>
<tr>
<td style="text-align:left;">
method
</td>
<td style="text-align:left;">
cosine
</td>
</tr>
<tr>
<td style="text-align:left;">
normalize
</td>
<td style="text-align:left;">
center
</td>
</tr>
<tr>
<td style="text-align:left;">
normalize_sim_matrix
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
alpha
</td>
<td style="text-align:left;">
0.5
</td>
</tr>
<tr>
<td style="text-align:left;">
na_as_zero
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:left;">
default
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
method
</td>
<td style="text-align:left;">
cosine
</td>
</tr>
<tr>
<td style="text-align:left;">
nn
</td>
<td style="text-align:left;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
sample
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
weighted
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;">
normalize
</td>
<td style="text-align:left;">
center
</td>
</tr>
<tr>
<td style="text-align:left;">
min_matching_items
</td>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
min_predictive_items
</td>
<td style="text-align:left;">
0
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<ul>
<li><code>k</code>: k 個最相似的物品</li>
<li><code>method</code>: 相似函數</li>
<li><code>nn</code>: 相似使用者的個數</li>
</ul>
<pre><code>model = Recommender(data, method, parameter=list(k=30))
getModel(model)</code></pre>
<ul>
<li>使用<code>getModel</code>取得模型的細節</li>
</ul>
<hr />
<div id="IBCF" class="section level3 hasAnchor" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> [Rating] Item-based Collaborative Filtering<a href="collaborative-filtering.html#IBCF" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>IBCF考慮使用者的購買紀錄並推薦相似的物品，其核心演算法基於下列的步驟:</p>
<ol style="list-style-type: decimal">
<li>對於每兩個物品，測量它們在接收到相似用戶評分方面的相似性</li>
<li>對於每個物品，識別 k 個最相似的物品</li>
<li>對於每個用戶，識別與該用戶購買最相似的物品</li>
</ol>
<div id="build-model" class="section level4 hasAnchor" number="5.6.1.1">
<h4><span class="header-section-number">5.6.1.1</span> Build model<a href="collaborative-filtering.html#build-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="collaborative-filtering.html#cb254-1" tabindex="-1"></a>model_I <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(<span class="at">data =</span> ratings_movies, <span class="at">method =</span> <span class="st">&quot;IBCF&quot;</span>)</span>
<span id="cb254-2"><a href="collaborative-filtering.html#cb254-2" tabindex="-1"></a></span>
<span id="cb254-3"><a href="collaborative-filtering.html#cb254-3" tabindex="-1"></a>model_details <span class="ot">&lt;-</span> <span class="fu">getModel</span>(model_I)</span>
<span id="cb254-4"><a href="collaborative-filtering.html#cb254-4" tabindex="-1"></a><span class="fu">names</span>(model_details) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">3</span>) <span class="sc">|&gt;</span> pander<span class="sc">::</span><span class="fu">pander</span>()</span></code></pre></div>
<table style="width:69%;">
<colgroup>
<col width="19%" />
<col width="31%" />
<col width="18%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="center">description</td>
<td align="center">method</td>
<td align="center">alpha</td>
</tr>
<tr class="even">
<td align="center">sim</td>
<td align="center">normalize</td>
<td align="center">na_as_zero</td>
</tr>
<tr class="odd">
<td align="center">k</td>
<td align="center">normalize_sim_matrix</td>
<td align="center">verbose</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="collaborative-filtering.html#cb255-1" tabindex="-1"></a>model_details<span class="sc">$</span>description</span></code></pre></div>
<pre><code>## [1] &quot;IBCF: Reduced similarity matrix&quot;</code></pre>
<ul>
<li class="downarrow">
sim包含相似矩陣，可以看到方陣的大小和項目數相同<a href="Example:%20Movie">(原始資料矩陣)</a>
</li>
</ul>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="collaborative-filtering.html#cb257-1" tabindex="-1"></a><span class="fu">class</span>(model_details<span class="sc">$</span>sim)</span>
<span id="cb257-2"><a href="collaborative-filtering.html#cb257-2" tabindex="-1"></a><span class="fu">dim</span>(model_details<span class="sc">$</span>sim)</span></code></pre></div>
<pre><code>## [1] &quot;dgCMatrix&quot;
## attr(,&quot;package&quot;)
## [1] &quot;Matrix&quot;
## [1] 332 332</code></pre>
<ul>
<li class="downarrow">
我們可以看到很多地方等於0，因為每列只有<code>k=30</code>個物品，我們可以透過加總每列數值&gt;0的個數來檢查
</li>
</ul>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="collaborative-filtering.html#cb259-1" tabindex="-1"></a><span class="fu">image</span>(model_details<span class="sc">$</span>sim[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>], </span>
<span id="cb259-2"><a href="collaborative-filtering.html#cb259-2" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Heatmap of complete similiarity matrix&quot;</span>)</span></code></pre></div>
<p><img src="bookdown-RS_files/figure-html/unnamed-chunk-149-1.png" width="1152" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="collaborative-filtering.html#cb260-1" tabindex="-1"></a>model_details<span class="sc">$</span>k</span></code></pre></div>
<pre><code>## [1] 30</code></pre>
<div id="hand-on-problem-1" class="section level5 unnumbered hasAnchor">
<h5>Hand-on problem 1<a href="collaborative-filtering.html#hand-on-problem-1" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="collaborative-filtering.html#cb262-1" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">rowSums</span>(model_details<span class="sc">$</span>sim <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb262-2"><a href="collaborative-filtering.html#cb262-2" tabindex="-1"></a><span class="fu">apply</span>(model_details<span class="sc">$</span>sim,<span class="dv">1</span>,<span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">&gt;</span><span class="dv">0</span>)) <span class="sc">|&gt;</span> <span class="fu">table</span>()</span></code></pre></div>
<pre><code>## 
##  30 
## 332 
## 
##  30 
## 332</code></pre>
<hr />
<blockquote>
<p>注意: <strong>這個矩陣不是對稱的</strong></p>
</blockquote>
<p>因為每列只有前30個相似性會被保留，所以實際上每行的非空元素依賴於相應電影被包含在另一部電影的前 k 名中的次數。</p>
<p>從圖<a href="collaborative-filtering.html#fig:IBCF-fig1">5.1</a>可以看到，有一些電影和很多其他的電影相似，表<a href="collaborative-filtering.html#tab:IBCF-tab1">5.2</a>列出了前6部和最多電影相似的電影</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="collaborative-filtering.html#cb264-1" tabindex="-1"></a>col_sums <span class="ot">&lt;-</span> <span class="fu">colSums</span>(model_details<span class="sc">$</span>sim <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb264-2"><a href="collaborative-filtering.html#cb264-2" tabindex="-1"></a>DF_col_sums<span class="ot">=</span><span class="fu">as.data.frame</span>(col_sums)</span>
<span id="cb264-3"><a href="collaborative-filtering.html#cb264-3" tabindex="-1"></a><span class="fu">ggplot</span>(DF_col_sums,<span class="fu">aes</span>(<span class="at">x=</span>col_sums)) <span class="sc">+</span></span>
<span id="cb264-4"><a href="collaborative-filtering.html#cb264-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:IBCF-fig1"></span>
<img src="bookdown-RS_files/figure-html/IBCF-fig1-1.png" alt="Distribution of the column count" width="1152" />
<p class="caption">
Figure 5.1: Distribution of the column count
</p>
</div>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="collaborative-filtering.html#cb265-1" tabindex="-1"></a>which_max <span class="ot">&lt;-</span> <span class="fu">order</span>(col_sums, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb265-2"><a href="collaborative-filtering.html#cb265-2" tabindex="-1"></a><span class="co"># rownames(model_details$sim)[which_max]</span></span></code></pre></div>
<table>
<caption>
<span id="tab:IBCF-tab1">Table 5.2: </span>movies with the most elements
</caption>
<thead>
<tr>
<th style="text-align:left;">
movie
</th>
<th style="text-align:right;">
col_sum
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Batman Forever (1995)
</td>
<td style="text-align:right;">
77
</td>
</tr>
<tr>
<td style="text-align:left;">
Close Shave, A (1995)
</td>
<td style="text-align:right;">
77
</td>
</tr>
<tr>
<td style="text-align:left;">
Jungle2Jungle (1997)
</td>
<td style="text-align:right;">
77
</td>
</tr>
<tr>
<td style="text-align:left;">
Wrong Trousers, The (1993)
</td>
<td style="text-align:right;">
77
</td>
</tr>
<tr>
<td style="text-align:left;">
Mimic (1997)
</td>
<td style="text-align:right;">
73
</td>
</tr>
<tr>
<td style="text-align:left;">
Ghost and the Darkness, The (1996)
</td>
<td style="text-align:right;">
72
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="predict-recommend-movies-to-users" class="section level4 hasAnchor" number="5.6.1.2">
<h4><span class="header-section-number">5.6.1.2</span> (Predict) Recommend movies to users<a href="collaborative-filtering.html#predict-recommend-movies-to-users" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>對於每個用戶，該算法提取其評分的電影。</p>
<p>對於每部電影，從相似性矩陣開始識別所有相似的項目。</p>
<p>然後，該算法按以下方式對每個相似的項目進行排名：</p>
<ol style="list-style-type: decimal">
<li>提取與此項目相關聯的用戶評分，該評分用作權重</li>
<li>提取與該項目相關聯的每個購買的相似性</li>
<li>將每個權重乘以相關的相似性並加總</li>
</ol>
<p>然後，該算法識別前 n 個推薦項目</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="collaborative-filtering.html#cb266-1" tabindex="-1"></a>pred_I <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> model_I,</span>
<span id="cb266-2"><a href="collaborative-filtering.html#cb266-2" tabindex="-1"></a>                  <span class="at">newdata =</span> ratings_movies,</span>
<span id="cb266-3"><a href="collaborative-filtering.html#cb266-3" tabindex="-1"></a>                  <span class="at">n =</span> <span class="dv">6</span>,</span>
<span id="cb266-4"><a href="collaborative-filtering.html#cb266-4" tabindex="-1"></a>                  <span class="at">type=</span><span class="fu">c</span>(<span class="st">&quot;topNList&quot;</span>,<span class="st">&quot;ratings&quot;</span>,<span class="st">&quot;ratingMatrix&quot;</span>)[<span class="dv">1</span>])</span>
<span id="cb266-5"><a href="collaborative-filtering.html#cb266-5" tabindex="-1"></a>pred_I</span></code></pre></div>
<pre><code>## Recommendations as &#39;topNList&#39; with n = 6 for 560 users.</code></pre>
<ul>
<li class="downarrow">
<code>pred_I</code>包含推薦
</li>
</ul>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="collaborative-filtering.html#cb268-1" tabindex="-1"></a><span class="fu">class</span>(pred_I)</span>
<span id="cb268-2"><a href="collaborative-filtering.html#cb268-2" tabindex="-1"></a><span class="fu">slotNames</span>(pred_I)</span></code></pre></div>
<pre><code>## [1] &quot;topNList&quot;
## attr(,&quot;package&quot;)
## [1] &quot;recommenderlab&quot;
## [1] &quot;items&quot;      &quot;ratings&quot;    &quot;itemLabels&quot; &quot;n&quot;</code></pre>
<ul>
<li><code>items</code>: 每個用戶推薦項目的索引列表</li>
<li><code>itemLabels</code>: 項目的名稱</li>
<li><code>n</code>: 推薦數量</li>
</ul>
<div id="hand-on-problem-2" class="section level5 unnumbered hasAnchor">
<h5>Hand-on problem 2<a href="collaborative-filtering.html#hand-on-problem-2" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<ul>
<li class="downarrow">
以使用者1為例，表<a href="collaborative-filtering.html#tab:IBCF-tab2">5.3</a>列出了推薦給使用者1的6部電影
</li>
</ul>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="collaborative-filtering.html#cb270-1" tabindex="-1"></a>pred_I<span class="sc">@</span>items[[<span class="dv">1</span>]]</span>
<span id="cb270-2"><a href="collaborative-filtering.html#cb270-2" tabindex="-1"></a>pred_I<span class="sc">@</span>itemLabels[pred_I<span class="sc">@</span>items[[<span class="dv">1</span>]]]</span></code></pre></div>
<table>
<caption>
<span id="tab:IBCF-tab2">Table 5.3: </span>recommendations for the first user
</caption>
<thead>
<tr>
<th style="text-align:right;">
index
</th>
<th style="text-align:left;">
movie
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
55
</td>
<td style="text-align:left;">
Casablanca (1942)
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
Apt Pupil (1998)
</td>
</tr>
<tr>
<td style="text-align:right;">
188
</td>
<td style="text-align:left;">
Maltese Falcon, The (1941)
</td>
</tr>
<tr>
<td style="text-align:right;">
218
</td>
<td style="text-align:left;">
North by Northwest (1959)
</td>
</tr>
<tr>
<td style="text-align:right;">
189
</td>
<td style="text-align:left;">
Manchurian Candidate, The (1962)
</td>
</tr>
<tr>
<td style="text-align:right;">
260
</td>
<td style="text-align:left;">
Schindler’s List (1993)
</td>
</tr>
</tbody>
</table>
<ul>
<li class="downarrow">
我們可以建立一個各使用者的推薦矩陣，表<a href="collaborative-filtering.html#tab:IBCF-tab3">5.4</a>列出了推薦給前4個使用者的6部電影
</li>
</ul>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="collaborative-filtering.html#cb271-1" tabindex="-1"></a>recc_matrix <span class="ot">&lt;-</span> <span class="fu">sapply</span>(pred_I<span class="sc">@</span>items, <span class="cf">function</span>(x){</span>
<span id="cb271-2"><a href="collaborative-filtering.html#cb271-2" tabindex="-1"></a>  <span class="fu">colnames</span>(ratings_movies)[x]</span>
<span id="cb271-3"><a href="collaborative-filtering.html#cb271-3" tabindex="-1"></a>})</span>
<span id="cb271-4"><a href="collaborative-filtering.html#cb271-4" tabindex="-1"></a><span class="fu">dim</span>(recc_matrix)</span></code></pre></div>
<pre><code>## [1]   6 560</code></pre>
<table>
<caption>
<span id="tab:IBCF-tab3">Table 5.4: </span>recommendations for the first four users
</caption>
<thead>
<tr>
<th style="text-align:left;">
0
</th>
<th style="text-align:left;">
1
</th>
<th style="text-align:left;">
2
</th>
<th style="text-align:left;">
3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Casablanca (1942)
</td>
<td style="text-align:left;">
12 Angry Men (1957)
</td>
<td style="text-align:left;">
Bound (1996)
</td>
<td style="text-align:left;">
Trainspotting (1996)
</td>
</tr>
<tr>
<td style="text-align:left;">
Apt Pupil (1998)
</td>
<td style="text-align:left;">
African Queen, The (1951)
</td>
<td style="text-align:left;">
Donnie Brasco (1997)
</td>
<td style="text-align:left;">
GoodFellas (1990)
</td>
</tr>
<tr>
<td style="text-align:left;">
Maltese Falcon, The (1941)
</td>
<td style="text-align:left;">
Alien (1979)
</td>
<td style="text-align:left;">
In the Line of Fire (1993)
</td>
<td style="text-align:left;">
Killing Fields, The (1984)
</td>
</tr>
<tr>
<td style="text-align:left;">
North by Northwest (1959)
</td>
<td style="text-align:left;">
Aliens (1986)
</td>
<td style="text-align:left;">
My Left Foot (1989)
</td>
<td style="text-align:left;">
Platoon (1986)
</td>
</tr>
<tr>
<td style="text-align:left;">
Manchurian Candidate, The (1962)
</td>
<td style="text-align:left;">
Annie Hall (1977)
</td>
<td style="text-align:left;">
Rainmaker, The (1997)
</td>
<td style="text-align:left;">
Twelve Monkeys (1995)
</td>
</tr>
<tr>
<td style="text-align:left;">
Schindler’s List (1993)
</td>
<td style="text-align:left;">
Apocalypse Now (1979)
</td>
<td style="text-align:left;">
Seven Years in Tibet (1997)
</td>
<td style="text-align:left;">
Contact (1997)
</td>
</tr>
</tbody>
</table>
<ul>
<li class="downarrow">
接著我們可以查看最被推薦的電影，圖<a href="collaborative-filtering.html#fig:IBCF-fig2">5.2</a>顯示了各電影被推薦的次數之分布，我們可以看到大部分的電影只被推薦很少次，而少部分的電影被推薦很多次
</li>
</ul>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="collaborative-filtering.html#cb273-1" tabindex="-1"></a>number_of_items <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">table</span>(recc_matrix))</span>
<span id="cb273-2"><a href="collaborative-filtering.html#cb273-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x=</span>number_of_items))<span class="sc">+</span></span>
<span id="cb273-3"><a href="collaborative-filtering.html#cb273-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>x))<span class="sc">+</span></span>
<span id="cb273-4"><a href="collaborative-filtering.html#cb273-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;推薦次數&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:IBCF-fig2"></span>
<img src="bookdown-RS_files/figure-html/IBCF-fig2-1.png" alt="IBCF 推薦次數分布圖" width="1152" />
<p class="caption">
Figure 5.2: IBCF 推薦次數分布圖
</p>
</div>
<ul>
<li class="downarrow">
接著我們來查看哪幾部電影被推薦最多次，表<a href="collaborative-filtering.html#tab:IBCF-tab4">5.5</a>列出了前4部被推薦最多次的電影
</li>
</ul>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="collaborative-filtering.html#cb274-1" tabindex="-1"></a>number_of_items_top <span class="ot">&lt;-</span> number_of_items <span class="sc">|&gt;</span> </span>
<span id="cb274-2"><a href="collaborative-filtering.html#cb274-2" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb274-3"><a href="collaborative-filtering.html#cb274-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">4</span>)</span>
<span id="cb274-4"><a href="collaborative-filtering.html#cb274-4" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">data.frame</span>(</span>
<span id="cb274-5"><a href="collaborative-filtering.html#cb274-5" tabindex="-1"></a>  <span class="fu">names</span>(number_of_items_top),</span>
<span id="cb274-6"><a href="collaborative-filtering.html#cb274-6" tabindex="-1"></a>  number_of_items_top</span>
<span id="cb274-7"><a href="collaborative-filtering.html#cb274-7" tabindex="-1"></a>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Movie&quot;</span>, <span class="st">&quot;Recommend times&quot;</span>),</span>
<span id="cb274-8"><a href="collaborative-filtering.html#cb274-8" tabindex="-1"></a><span class="at">caption =</span> <span class="st">&quot;the most popular movies&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:IBCF-tab4">Table 5.5: </span>the most popular movies
</caption>
<thead>
<tr>
<th style="text-align:left;">
Movie
</th>
<th style="text-align:left;">
Recommend times
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
12 Angry Men (1957)
</td>
<td style="text-align:left;">
72
</td>
</tr>
<tr>
<td style="text-align:left;">
As Good As It Gets (1997)
</td>
<td style="text-align:left;">
53
</td>
</tr>
<tr>
<td style="text-align:left;">
Close Shave, A (1995)
</td>
<td style="text-align:left;">
53
</td>
</tr>
<tr>
<td style="text-align:left;">
Apocalypse Now (1979)
</td>
<td style="text-align:left;">
48
</td>
</tr>
</tbody>
</table>
<hr />
</div>
</div>
</div>
<div id="UBCF" class="section level3 hasAnchor" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> [Rating] User-based Collaborative Filtering<a href="collaborative-filtering.html#UBCF" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>UBCF演算法步驟:</p>
<ol style="list-style-type: decimal">
<li>測量使用者之間的相似性</li>
<li>識別最相似的使用者<br />
2.1. Top k: k nearest neighbors (KNN)<br />
2.2. threshold: 考慮相似性高於門檻值的使用者<br />
</li>
<li>計算最相似使用者購買過的物品之評分，評分為相似使用者之評分的平均<br />
3.1. 平均<br />
3.2. 加權平均，以相似性為權重</li>
</ol>
<div id="build-model-1" class="section level4 hasAnchor" number="5.6.2.1">
<h4><span class="header-section-number">5.6.2.1</span> Build model<a href="collaborative-filtering.html#build-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="collaborative-filtering.html#cb275-1" tabindex="-1"></a>model_U <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(<span class="at">data =</span> ratings_movies, <span class="at">method =</span> <span class="st">&quot;UBCF&quot;</span>)</span>
<span id="cb275-2"><a href="collaborative-filtering.html#cb275-2" tabindex="-1"></a></span>
<span id="cb275-3"><a href="collaborative-filtering.html#cb275-3" tabindex="-1"></a>model_details <span class="ot">&lt;-</span> <span class="fu">getModel</span>(model_U)</span>
<span id="cb275-4"><a href="collaborative-filtering.html#cb275-4" tabindex="-1"></a><span class="fu">names</span>(model_details) <span class="sc">|&gt;</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">3</span>) <span class="sc">|&gt;</span> pander<span class="sc">::</span><span class="fu">pander</span>()</span></code></pre></div>
<table style="width:81%;">
<colgroup>
<col width="19%" />
<col width="29%" />
<col width="31%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="center">description</td>
<td align="center">sample</td>
<td align="center">min_predictive_items</td>
</tr>
<tr class="even">
<td align="center">data</td>
<td align="center">weighted</td>
<td align="center">verbose</td>
</tr>
<tr class="odd">
<td align="center">method</td>
<td align="center">normalize</td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="center">nn</td>
<td align="center">min_matching_items</td>
<td align="center"></td>
</tr>
</tbody>
</table>
<ul>
<li class="downarrow">
<code>data</code>包含了評分矩陣，原因是UBCF需要訪問所有的資料來做預測
</li>
</ul>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="collaborative-filtering.html#cb276-1" tabindex="-1"></a>model_details<span class="sc">$</span>data</span></code></pre></div>
<pre><code>## 560 x 332 rating matrix of class &#39;realRatingMatrix&#39; with 55298 ratings.
## Normalized using center on rows.</code></pre>
</div>
<div id="predict-recommend-movies-to-users-1" class="section level4 hasAnchor" number="5.6.2.2">
<h4><span class="header-section-number">5.6.2.2</span> (Predict) Recommend movies to users<a href="collaborative-filtering.html#predict-recommend-movies-to-users-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="collaborative-filtering.html#cb278-1" tabindex="-1"></a>pred_U <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> model_U,</span>
<span id="cb278-2"><a href="collaborative-filtering.html#cb278-2" tabindex="-1"></a>                  <span class="at">newdata =</span> ratings_movies,</span>
<span id="cb278-3"><a href="collaborative-filtering.html#cb278-3" tabindex="-1"></a>                  <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb278-4"><a href="collaborative-filtering.html#cb278-4" tabindex="-1"></a>pred_U</span></code></pre></div>
<pre><code>## Recommendations as &#39;topNList&#39; with n = 6 for 560 users.</code></pre>
<ul>
<li class="downarrow">
表<a href="collaborative-filtering.html#tab:UBCF-tab1">5.6</a>列出了UBCF演算法推薦給前4個使用者的6部電影，IBCF推薦的見表<a href="collaborative-filtering.html#tab:IBCF-tab3">5.4</a>
</li>
</ul>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="collaborative-filtering.html#cb280-1" tabindex="-1"></a>recc_matrix <span class="ot">&lt;-</span> <span class="fu">sapply</span>(pred_U<span class="sc">@</span>items, <span class="cf">function</span>(x){</span>
<span id="cb280-2"><a href="collaborative-filtering.html#cb280-2" tabindex="-1"></a>  <span class="fu">colnames</span>(ratings_movies)[x]</span>
<span id="cb280-3"><a href="collaborative-filtering.html#cb280-3" tabindex="-1"></a>})</span>
<span id="cb280-4"><a href="collaborative-filtering.html#cb280-4" tabindex="-1"></a><span class="co"># dim(recc_matrix)</span></span></code></pre></div>
<table>
<caption>
<span id="tab:UBCF-tab1">Table 5.6: </span>recommendations for the first four users
</caption>
<thead>
<tr>
<th style="text-align:left;">
0
</th>
<th style="text-align:left;">
1
</th>
<th style="text-align:left;">
2
</th>
<th style="text-align:left;">
3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
In the Name of the Father (1993)
</td>
<td style="text-align:left;">
Welcome to the Dollhouse (1995)
</td>
<td style="text-align:left;">
Crying Game, The (1992)
</td>
<td style="text-align:left;">
Godfather: Part II, The (1974)
</td>
</tr>
<tr>
<td style="text-align:left;">
Shine (1996)
</td>
<td style="text-align:left;">
Amistad (1997)
</td>
<td style="text-align:left;">
Adventures of Priscilla, Queen of the Desert, The (1994)
</td>
<td style="text-align:left;">
Gone with the Wind (1939)
</td>
</tr>
<tr>
<td style="text-align:left;">
Close Shave, A (1995)
</td>
<td style="text-align:left;">
Big Night (1996)
</td>
<td style="text-align:left;">
Close Shave, A (1995)
</td>
<td style="text-align:left;">
Big Night (1996)
</td>
</tr>
<tr>
<td style="text-align:left;">
Secrets &amp; Lies (1996)
</td>
<td style="text-align:left;">
Strictly Ballroom (1992)
</td>
<td style="text-align:left;">
Wrong Trousers, The (1993)
</td>
<td style="text-align:left;">
Wizard of Oz, The (1939)
</td>
</tr>
<tr>
<td style="text-align:left;">
Apt Pupil (1998)
</td>
<td style="text-align:left;">
Blade Runner (1982)
</td>
<td style="text-align:left;">
Sleepers (1996)
</td>
<td style="text-align:left;">
Lawrence of Arabia (1962)
</td>
</tr>
<tr>
<td style="text-align:left;">
Cool Hand Luke (1967)
</td>
<td style="text-align:left;">
Cold Comfort Farm (1995)
</td>
<td style="text-align:left;">
North by Northwest (1959)
</td>
<td style="text-align:left;">
Raging Bull (1980)
</td>
</tr>
</tbody>
</table>
<ul>
<li class="downarrow">
圖<a href="collaborative-filtering.html#fig:UBCF-fig1">5.3</a>顯示了各電影被推薦的次數之分布，和IBCF演算法的結果(圖<a href="collaborative-filtering.html#fig:IBCF-fig2">5.2</a>)相比，UBCF有更長的尾巴，表示有些電影更常被推薦
</li>
</ul>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="collaborative-filtering.html#cb281-1" tabindex="-1"></a>number_of_items <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">table</span>(recc_matrix))</span>
<span id="cb281-2"><a href="collaborative-filtering.html#cb281-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x=</span>number_of_items))<span class="sc">+</span></span>
<span id="cb281-3"><a href="collaborative-filtering.html#cb281-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>x))<span class="sc">+</span></span>
<span id="cb281-4"><a href="collaborative-filtering.html#cb281-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;推薦次數&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:UBCF-fig1"></span>
<img src="bookdown-RS_files/figure-html/UBCF-fig1-1.png" alt="UBCF 推薦次數分布圖" width="1152" />
<p class="caption">
Figure 5.3: UBCF 推薦次數分布圖
</p>
</div>
<ul>
<li class="downarrow">
表<a href="collaborative-filtering.html#tab:UBCF-tab2">5.7</a>列出了前4部被UBCF推薦最多次的電影，IBCF的結果見表<a href="collaborative-filtering.html#tab:IBCF-tab4">5.5</a>
</li>
</ul>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="collaborative-filtering.html#cb282-1" tabindex="-1"></a>number_of_items_top <span class="ot">&lt;-</span> number_of_items <span class="sc">|&gt;</span> </span>
<span id="cb282-2"><a href="collaborative-filtering.html#cb282-2" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb282-3"><a href="collaborative-filtering.html#cb282-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">4</span>)</span>
<span id="cb282-4"><a href="collaborative-filtering.html#cb282-4" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">data.frame</span>(</span>
<span id="cb282-5"><a href="collaborative-filtering.html#cb282-5" tabindex="-1"></a>  <span class="fu">names</span>(number_of_items_top),</span>
<span id="cb282-6"><a href="collaborative-filtering.html#cb282-6" tabindex="-1"></a>  number_of_items_top</span>
<span id="cb282-7"><a href="collaborative-filtering.html#cb282-7" tabindex="-1"></a>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Movie&quot;</span>, <span class="st">&quot;Recommend times&quot;</span>),</span>
<span id="cb282-8"><a href="collaborative-filtering.html#cb282-8" tabindex="-1"></a><span class="at">caption =</span> <span class="st">&quot;the most popular movies&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:UBCF-tab2">Table 5.7: </span>the most popular movies
</caption>
<thead>
<tr>
<th style="text-align:left;">
Movie
</th>
<th style="text-align:left;">
Recommend times
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Close Shave, A (1995)
</td>
<td style="text-align:left;">
169
</td>
</tr>
<tr>
<td style="text-align:left;">
Good Will Hunting (1997)
</td>
<td style="text-align:left;">
94
</td>
</tr>
<tr>
<td style="text-align:left;">
Wrong Trousers, The (1993)
</td>
<td style="text-align:left;">
73
</td>
</tr>
<tr>
<td style="text-align:left;">
Secrets &amp; Lies (1996)
</td>
<td style="text-align:left;">
68
</td>
</tr>
</tbody>
</table>
<hr />
</div>
</div>
</div>
<div id="binary-example-movie" class="section level2 hasAnchor" number="5.7">
<h2><span class="header-section-number">5.7</span> [Binary] Example: Movie<a href="collaborative-filtering.html#binary-example-movie" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>前面我們使用了評分來建立模型，但有可能有下列的情況發生:</p>
<ul>
<li>我們知道已經購買了哪些項目，但不知道它們的評分</li>
<li>對於每個用戶，我們不知道它購買了哪些項目，但我們知道它喜歡哪些項目</li>
</ul>
<p>在這些情況下，我們可以建立一個矩陣，其值不是評分，而是0/1資料，<strong>如果使用者購買或喜歡該物品則記為1，否則為0</strong>。</p>
<ul>
<li class="downarrow">
在我們的情況中，從 <code>ratings_movies</code> 開始，我們可以建立一個 <code>ratings_movies_watched</code> 矩陣，如果用戶看了電影為 1，否則為 0。圖<a href="collaborative-filtering.html#fig:bin-fig1">5.4</a>顯示每個使用者觀看了幾部電影的分布，紅色虛線為平均，約為100部
</li>
</ul>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="collaborative-filtering.html#cb283-1" tabindex="-1"></a>ratings_movies_watched <span class="ot">&lt;-</span> <span class="fu">binarize</span>(ratings_movies, <span class="at">minRating =</span> <span class="dv">1</span>)</span>
<span id="cb283-2"><a href="collaborative-filtering.html#cb283-2" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">rowSums</span>(ratings_movies_watched)) <span class="sc">+</span></span>
<span id="cb283-3"><a href="collaborative-filtering.html#cb283-3" tabindex="-1"></a>  <span class="fu">stat_bin</span>(<span class="at">binwidth =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb283-4"><a href="collaborative-filtering.html#cb283-4" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(<span class="fu">rowSums</span>(ratings_movies_watched)),</span>
<span id="cb283-5"><a href="collaborative-filtering.html#cb283-5" tabindex="-1"></a>             <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:bin-fig1"></span>
<img src="bookdown-RS_files/figure-html/bin-fig1-1.png" alt="Distribution of movies by user" width="1152" />
<p class="caption">
Figure 5.4: Distribution of movies by user
</p>
</div>
<hr />
<div id="binary-item-based-collaborative-filtering" class="section level3 hasAnchor" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> [Binary] Item-based Collaborative Filtering<a href="collaborative-filtering.html#binary-item-based-collaborative-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>表<a href="collaborative-filtering.html#tab:bin-IBCF-tab1">5.8</a>列出了IBCF在二元資料推薦給前4個使用者的結果，評分資料的結果見表<a href="collaborative-filtering.html#tab:IBCF-tab3">5.4</a></p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="collaborative-filtering.html#cb284-1" tabindex="-1"></a>bin_model_I <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(</span>
<span id="cb284-2"><a href="collaborative-filtering.html#cb284-2" tabindex="-1"></a>  <span class="at">data =</span> ratings_movies_watched,</span>
<span id="cb284-3"><a href="collaborative-filtering.html#cb284-3" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;IBCF&quot;</span>,</span>
<span id="cb284-4"><a href="collaborative-filtering.html#cb284-4" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;Jaccard&quot;</span>)</span>
<span id="cb284-5"><a href="collaborative-filtering.html#cb284-5" tabindex="-1"></a>)</span>
<span id="cb284-6"><a href="collaborative-filtering.html#cb284-6" tabindex="-1"></a><span class="co"># model_details &lt;- getModel(bin_model_I)</span></span>
<span id="cb284-7"><a href="collaborative-filtering.html#cb284-7" tabindex="-1"></a>recc_predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> bin_model_I, </span>
<span id="cb284-8"><a href="collaborative-filtering.html#cb284-8" tabindex="-1"></a>                          <span class="at">newdata =</span> ratings_movies_watched,</span>
<span id="cb284-9"><a href="collaborative-filtering.html#cb284-9" tabindex="-1"></a>                          <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb284-10"><a href="collaborative-filtering.html#cb284-10" tabindex="-1"></a>recc_matrix <span class="ot">&lt;-</span> <span class="fu">sapply</span>(recc_predicted<span class="sc">@</span>items, <span class="cf">function</span>(x){</span>
<span id="cb284-11"><a href="collaborative-filtering.html#cb284-11" tabindex="-1"></a>  <span class="fu">colnames</span>(ratings_movies_watched)[x]</span>
<span id="cb284-12"><a href="collaborative-filtering.html#cb284-12" tabindex="-1"></a>})</span></code></pre></div>
<table>
<caption>
<span id="tab:bin-IBCF-tab1">Table 5.8: </span>recommendations for the first four users
</caption>
<thead>
<tr>
<th style="text-align:left;">
0
</th>
<th style="text-align:left;">
1
</th>
<th style="text-align:left;">
2
</th>
<th style="text-align:left;">
3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
E.T. the Extra-Terrestrial (1982)
</td>
<td style="text-align:left;">
Empire Strikes Back, The (1980)
</td>
<td style="text-align:left;">
Raiders of the Lost Ark (1981)
</td>
<td style="text-align:left;">
Pulp Fiction (1994)
</td>
</tr>
<tr>
<td style="text-align:left;">
Speed (1994)
</td>
<td style="text-align:left;">
Return of the Jedi (1983)
</td>
<td style="text-align:left;">
Star Wars (1977)
</td>
<td style="text-align:left;">
Terminator, The (1984)
</td>
</tr>
<tr>
<td style="text-align:left;">
True Lies (1994)
</td>
<td style="text-align:left;">
Silence of the Lambs, The (1991)
</td>
<td style="text-align:left;">
Empire Strikes Back, The (1980)
</td>
<td style="text-align:left;">
Jurassic Park (1993)
</td>
</tr>
<tr>
<td style="text-align:left;">
Batman (1989)
</td>
<td style="text-align:left;">
Raiders of the Lost Ark (1981)
</td>
<td style="text-align:left;">
Indiana Jones and the Last Crusade (1989)
</td>
<td style="text-align:left;">
Terminator 2: Judgment Day (1991)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mission: Impossible (1996)
</td>
<td style="text-align:left;">
Indiana Jones and the Last Crusade (1989)
</td>
<td style="text-align:left;">
Back to the Future (1985)
</td>
<td style="text-align:left;">
Groundhog Day (1993)
</td>
</tr>
<tr>
<td style="text-align:left;">
Schindler’s List (1993)
</td>
<td style="text-align:left;">
Back to the Future (1985)
</td>
<td style="text-align:left;">
Pulp Fiction (1994)
</td>
<td style="text-align:left;">
Braveheart (1995)
</td>
</tr>
</tbody>
</table>
<hr />
</div>
<div id="binary-user-based-collaborative-filtering" class="section level3 hasAnchor" number="5.7.2">
<h3><span class="header-section-number">5.7.2</span> [Binary] User-based Collaborative Filtering<a href="collaborative-filtering.html#binary-user-based-collaborative-filtering" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>表<a href="collaborative-filtering.html#tab:bin-UBCF-tab1">5.9</a>列出了UBCF在二元資料推薦給前4個使用者的結果，評分資料的結果見表<a href="collaborative-filtering.html#tab:UBCF-tab1">5.6</a></p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="collaborative-filtering.html#cb285-1" tabindex="-1"></a>bin_model_U <span class="ot">&lt;-</span> <span class="fu">Recommender</span>(</span>
<span id="cb285-2"><a href="collaborative-filtering.html#cb285-2" tabindex="-1"></a>  <span class="at">data =</span> ratings_movies_watched,</span>
<span id="cb285-3"><a href="collaborative-filtering.html#cb285-3" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;UBCF&quot;</span>,</span>
<span id="cb285-4"><a href="collaborative-filtering.html#cb285-4" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">&quot;Jaccard&quot;</span>)</span>
<span id="cb285-5"><a href="collaborative-filtering.html#cb285-5" tabindex="-1"></a>)</span>
<span id="cb285-6"><a href="collaborative-filtering.html#cb285-6" tabindex="-1"></a>recc_predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="at">object =</span> bin_model_U, </span>
<span id="cb285-7"><a href="collaborative-filtering.html#cb285-7" tabindex="-1"></a>                          <span class="at">newdata =</span> ratings_movies_watched,</span>
<span id="cb285-8"><a href="collaborative-filtering.html#cb285-8" tabindex="-1"></a>                          <span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb285-9"><a href="collaborative-filtering.html#cb285-9" tabindex="-1"></a>recc_matrix <span class="ot">&lt;-</span> <span class="fu">sapply</span>(recc_predicted<span class="sc">@</span>items, <span class="cf">function</span>(x){</span>
<span id="cb285-10"><a href="collaborative-filtering.html#cb285-10" tabindex="-1"></a>  <span class="fu">colnames</span>(ratings_movies_watched)[x]</span>
<span id="cb285-11"><a href="collaborative-filtering.html#cb285-11" tabindex="-1"></a>})</span></code></pre></div>
<table>
<caption>
<span id="tab:bin-UBCF-tab1">Table 5.9: </span>recommendations for the first four users
</caption>
<thead>
<tr>
<th style="text-align:left;">
0
</th>
<th style="text-align:left;">
1
</th>
<th style="text-align:left;">
2
</th>
<th style="text-align:left;">
3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Father of the Bride Part II (1995)
</td>
<td style="text-align:left;">
Boot, Das (1981)
</td>
<td style="text-align:left;">
Jungle2Jungle (1997)
</td>
<td style="text-align:left;">
Philadelphia Story, The (1940)
</td>
</tr>
<tr>
<td style="text-align:left;">
Killing Fields, The (1984)
</td>
<td style="text-align:left;">
North by Northwest (1959)
</td>
<td style="text-align:left;">
George of the Jungle (1997)
</td>
<td style="text-align:left;">
Remains of the Day, The (1993)
</td>
</tr>
<tr>
<td style="text-align:left;">
First Wives Club, The (1996)
</td>
<td style="text-align:left;">
Willy Wonka and the Chocolate Factory (1971)
</td>
<td style="text-align:left;">
Fly Away Home (1996)
</td>
<td style="text-align:left;">
Dead Man Walking (1995)
</td>
</tr>
<tr>
<td style="text-align:left;">
My Left Foot (1989)
</td>
<td style="text-align:left;">
Mother (1996)
</td>
<td style="text-align:left;">
Beauty and the Beast (1991)
</td>
<td style="text-align:left;">
Cool Hand Luke (1967)
</td>
</tr>
<tr>
<td style="text-align:left;">
Fly Away Home (1996)
</td>
<td style="text-align:left;">
Cold Comfort Farm (1995)
</td>
<td style="text-align:left;">
Gone with the Wind (1939)
</td>
<td style="text-align:left;">
As Good As It Gets (1997)
</td>
</tr>
<tr>
<td style="text-align:left;">
Primal Fear (1996)
</td>
<td style="text-align:left;">
Big Night (1996)
</td>
<td style="text-align:left;">
Stargate (1994)
</td>
<td style="text-align:left;">
Deer Hunter, The (1978)
</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="self-learning-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="self-learning-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "night",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"info": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
